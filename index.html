<!doctype html><html lang="en">
 <head>
  <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
  <meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport">
  <title>Page Unload Beacon</title>
  <meta content="UD" name="w3c-status">
  <link href="https://www.w3.org/StyleSheets/TR/2021/W3C-UD" rel="stylesheet">
  <link href="https://www.w3.org/2008/site/images/favicon.ico" rel="icon">
  <meta content="Bikeshed version fb1e763a4, updated Tue Mar 1 13:13:50 2022 -0800" name="generator">
  <link href="http://wicg.github.io/unload-beacon/" rel="canonical">
  <meta content="2dd0628f4f470b18b6e32c90e1a74ce9c742c922" name="document-revision">
<style>/* style-autolinks */

.css.css, .property.property, .descriptor.descriptor {
    color: var(--a-normal-text);
    font-size: inherit;
    font-family: inherit;
}
.css::before, .property::before, .descriptor::before {
    content: "‘";
}
.css::after, .property::after, .descriptor::after {
    content: "’";
}
.property, .descriptor {
    /* Don't wrap property and descriptor names */
    white-space: nowrap;
}
.type { /* CSS value <type> */
    font-style: italic;
}
pre .property::before, pre .property::after {
    content: "";
}
[data-link-type="property"]::before,
[data-link-type="propdesc"]::before,
[data-link-type="descriptor"]::before,
[data-link-type="value"]::before,
[data-link-type="function"]::before,
[data-link-type="at-rule"]::before,
[data-link-type="selector"]::before,
[data-link-type="maybe"]::before {
    content: "‘";
}
[data-link-type="property"]::after,
[data-link-type="propdesc"]::after,
[data-link-type="descriptor"]::after,
[data-link-type="value"]::after,
[data-link-type="function"]::after,
[data-link-type="at-rule"]::after,
[data-link-type="selector"]::after,
[data-link-type="maybe"]::after {
    content: "’";
}

[data-link-type].production::before,
[data-link-type].production::after,
.prod [data-link-type]::before,
.prod [data-link-type]::after {
    content: "";
}

[data-link-type=element],
[data-link-type=element-attr] {
    font-family: Menlo, Consolas, "DejaVu Sans Mono", monospace;
    font-size: .9em;
}
[data-link-type=element]::before { content: "<" }
[data-link-type=element]::after  { content: ">" }

[data-link-type=biblio] {
    white-space: pre;
}</style>
<style>/* style-colors */

/* Any --*-text not paired with a --*-bg is assumed to have a transparent bg */
:root {
    color-scheme: light dark;

    --text: black;
    --bg: white;

    --unofficial-watermark: url(https://www.w3.org/StyleSheets/TR/2016/logos/UD-watermark);

    --logo-bg: #1a5e9a;
    --logo-active-bg: #c00;
    --logo-text: white;

    --tocnav-normal-text: #707070;
    --tocnav-normal-bg: var(--bg);
    --tocnav-hover-text: var(--tocnav-normal-text);
    --tocnav-hover-bg: #f8f8f8;
    --tocnav-active-text: #c00;
    --tocnav-active-bg: var(--tocnav-normal-bg);

    --tocsidebar-text: var(--text);
    --tocsidebar-bg: #f7f8f9;
    --tocsidebar-shadow: rgba(0,0,0,.1);
    --tocsidebar-heading-text: hsla(203,20%,40%,.7);

    --toclink-text: var(--text);
    --toclink-underline: #3980b5;
    --toclink-visited-text: var(--toclink-text);
    --toclink-visited-underline: #054572;

    --heading-text: #005a9c;

    --hr-text: var(--text);

    --algo-border: #def;

    --del-text: red;
    --del-bg: transparent;
    --ins-text: #080;
    --ins-bg: transparent;

    --a-normal-text: #034575;
    --a-normal-underline: #bbb;
    --a-visited-text: var(--a-normal-text);
    --a-visited-underline: #707070;
    --a-hover-bg: rgba(75%, 75%, 75%, .25);
    --a-active-text: #c00;
    --a-active-underline: #c00;

    --blockquote-border: silver;
    --blockquote-bg: transparent;
    --blockquote-text: currentcolor;

    --issue-border: #e05252;
    --issue-bg: #fbe9e9;
    --issue-text: var(--text);
    --issueheading-text: #831616;

    --example-border: #e0cb52;
    --example-bg: #fcfaee;
    --example-text: var(--text);
    --exampleheading-text: #574b0f;

    --note-border: #52e052;
    --note-bg: #e9fbe9;
    --note-text: var(--text);
    --noteheading-text: hsl(120, 70%, 30%);
    --notesummary-underline: silver;

    --assertion-border: #aaa;
    --assertion-bg: #eee;
    --assertion-text: black;

    --advisement-border: orange;
    --advisement-bg: #fec;
    --advisement-text: var(--text);
    --advisementheading-text: #b35f00;

    --warning-border: red;
    --warning-bg: hsla(40,100%,50%,0.95);
    --warning-text: var(--text);

    --amendment-border: #330099;
    --amendment-bg: #F5F0FF;
    --amendment-text: var(--text);
    --amendmentheading-text: #220066;

    --def-border: #8ccbf2;
    --def-bg: #def;
    --def-text: var(--text);
    --defrow-border: #bbd7e9;

    --datacell-border: silver;

    --indexinfo-text: #707070;

    --indextable-hover-text: black;
    --indextable-hover-bg: #f7f8f9;

    --outdatedspec-bg: rgba(0, 0, 0, .5);
    --outdatedspec-text: black;
    --outdated-bg: maroon;
    --outdated-text: white;
    --outdated-shadow: red;

    --editedrec-bg: darkorange;
}</style>
<style>/* style-counters */

body {
    counter-reset: example figure issue;
}
.issue {
    counter-increment: issue;
}
.issue:not(.no-marker)::before {
    content: "Issue " counter(issue);
}

.example {
    counter-increment: example;
}
.example:not(.no-marker)::before {
    content: "Example " counter(example);
}
.invalid.example:not(.no-marker)::before,
.illegal.example:not(.no-marker)::before {
    content: "Invalid Example" counter(example);
}

figcaption {
    counter-increment: figure;
}
figcaption:not(.no-marker)::before {
    content: "Figure " counter(figure) " ";
}</style>
<style>/* style-dfn-panel */

:root {
    --dfnpanel-bg: #ddd;
    --dfnpanel-text: var(--text);
}
.dfn-panel {
    position: absolute;
    z-index: 35;
    height: auto;
    width: -webkit-fit-content;
    width: fit-content;
    max-width: 300px;
    max-height: 500px;
    overflow: auto;
    padding: 0.5em 0.75em;
    font: small Helvetica Neue, sans-serif, Droid Sans Fallback;
    background: var(--dfnpanel-bg);
    color: var(--dfnpanel-text);
    border: outset 0.2em;
}
.dfn-panel:not(.on) { display: none; }
.dfn-panel * { margin: 0; padding: 0; text-indent: 0; }
.dfn-panel > b { display: block; }
.dfn-panel a { color: var(--dfnpanel-text); }
.dfn-panel a:not(:hover) { text-decoration: none !important; border-bottom: none !important; }
.dfn-panel > b + b { margin-top: 0.25em; }
.dfn-panel ul { padding: 0; }
.dfn-panel li { list-style: inside; }
.dfn-panel.activated {
    display: inline-block;
    position: fixed;
    left: .5em;
    bottom: 2em;
    margin: 0 auto;
    max-width: calc(100vw - 1.5em - .4em - .5em);
    max-height: 30vh;
}

.dfn-paneled { cursor: pointer; }
</style>
<style>/* style-issues */

a[href].issue-return {
    float: right;
    float: inline-end;
    color: var(--issueheading-text);
    font-weight: bold;
    text-decoration: none;
}
</style>
<style>/* style-md-lists */

/* This is a weird hack for me not yet following the commonmark spec
   regarding paragraph and lists. */
[data-md] > :first-child {
    margin-top: 0;
}
[data-md] > :last-child {
    margin-bottom: 0;
}</style>
<style>/* style-selflinks */

:root {
    --selflink-text: white;
    --selflink-bg: gray;
    --selflink-hover-text: black;
}
.heading, .issue, .note, .example, li, dt {
    position: relative;
}
a.self-link {
    position: absolute;
    top: 0;
    left: calc(-1 * (3.5rem - 26px));
    width: calc(3.5rem - 26px);
    height: 2em;
    text-align: center;
    border: none;
    transition: opacity .2s;
    opacity: .5;
}
a.self-link:hover {
    opacity: 1;
}
.heading > a.self-link {
    font-size: 83%;
}
li > a.self-link {
    left: calc(-1 * (3.5rem - 26px) - 2em);
}
dfn > a.self-link {
    top: auto;
    left: auto;
    opacity: 0;
    width: 1.5em;
    height: 1.5em;
    background: var(--selflink-bg);
    color: var(--selflink-text);
    font-style: normal;
    transition: opacity .2s, background-color .2s, color .2s;
}
dfn:hover > a.self-link {
    opacity: 1;
}
dfn > a.self-link:hover {
    color: var(--selflink-hover-text);
}

a.self-link::before            { content: "¶"; }
.heading > a.self-link::before { content: "§"; }
dfn > a.self-link::before      { content: "#"; }
</style>
<style>/* style-syntax-highlighting */

            pre.idl.highlight {
                background: var(--borderedblock-bg, var(--def-bg));
            }
            
code.highlight { padding: .1em; border-radius: .3em; }
pre.highlight, pre > code.highlight { display: block; padding: 1em; margin: .5em 0; overflow: auto; border-radius: 0; }

.highlight:not(.idl) { background: rgba(0, 0, 0, .03); }
c-[a] { color: #990055 } /* Keyword.Declaration */
c-[b] { color: #990055 } /* Keyword.Type */
c-[c] { color: #708090 } /* Comment */
c-[d] { color: #708090 } /* Comment.Multiline */
c-[e] { color: #0077aa } /* Name.Attribute */
c-[f] { color: #669900 } /* Name.Tag */
c-[g] { color: #222222 } /* Name.Variable */
c-[k] { color: #990055 } /* Keyword */
c-[l] { color: #000000 } /* Literal */
c-[m] { color: #000000 } /* Literal.Number */
c-[n] { color: #0077aa } /* Name */
c-[o] { color: #999999 } /* Operator */
c-[p] { color: #999999 } /* Punctuation */
c-[s] { color: #a67f59 } /* Literal.String */
c-[t] { color: #a67f59 } /* Literal.String.Single */
c-[u] { color: #a67f59 } /* Literal.String.Double */
c-[cp] { color: #708090 } /* Comment.Preproc */
c-[c1] { color: #708090 } /* Comment.Single */
c-[cs] { color: #708090 } /* Comment.Special */
c-[kc] { color: #990055 } /* Keyword.Constant */
c-[kn] { color: #990055 } /* Keyword.Namespace */
c-[kp] { color: #990055 } /* Keyword.Pseudo */
c-[kr] { color: #990055 } /* Keyword.Reserved */
c-[ld] { color: #000000 } /* Literal.Date */
c-[nc] { color: #0077aa } /* Name.Class */
c-[no] { color: #0077aa } /* Name.Constant */
c-[nd] { color: #0077aa } /* Name.Decorator */
c-[ni] { color: #0077aa } /* Name.Entity */
c-[ne] { color: #0077aa } /* Name.Exception */
c-[nf] { color: #0077aa } /* Name.Function */
c-[nl] { color: #0077aa } /* Name.Label */
c-[nn] { color: #0077aa } /* Name.Namespace */
c-[py] { color: #0077aa } /* Name.Property */
c-[ow] { color: #999999 } /* Operator.Word */
c-[mb] { color: #000000 } /* Literal.Number.Bin */
c-[mf] { color: #000000 } /* Literal.Number.Float */
c-[mh] { color: #000000 } /* Literal.Number.Hex */
c-[mi] { color: #000000 } /* Literal.Number.Integer */
c-[mo] { color: #000000 } /* Literal.Number.Oct */
c-[sb] { color: #a67f59 } /* Literal.String.Backtick */
c-[sc] { color: #a67f59 } /* Literal.String.Char */
c-[sd] { color: #a67f59 } /* Literal.String.Doc */
c-[se] { color: #a67f59 } /* Literal.String.Escape */
c-[sh] { color: #a67f59 } /* Literal.String.Heredoc */
c-[si] { color: #a67f59 } /* Literal.String.Interpol */
c-[sx] { color: #a67f59 } /* Literal.String.Other */
c-[sr] { color: #a67f59 } /* Literal.String.Regex */
c-[ss] { color: #a67f59 } /* Literal.String.Symbol */
c-[vc] { color: #0077aa } /* Name.Variable.Class */
c-[vg] { color: #0077aa } /* Name.Variable.Global */
c-[vi] { color: #0077aa } /* Name.Variable.Instance */
c-[il] { color: #000000 } /* Literal.Number.Integer.Long */
</style>
<style>/* style-var-click-highlighting */

    var { cursor: pointer; }
    var.selected0 { background-color: #F4D200; box-shadow: 0 0 0 2px #F4D200; }
    var.selected1 { background-color: #FF87A2; box-shadow: 0 0 0 2px #FF87A2; }
    var.selected2 { background-color: #96E885; box-shadow: 0 0 0 2px #96E885; }
    var.selected3 { background-color: #3EEED2; box-shadow: 0 0 0 2px #3EEED2; }
    var.selected4 { background-color: #EACFB6; box-shadow: 0 0 0 2px #EACFB6; }
    var.selected5 { background-color: #82DDFF; box-shadow: 0 0 0 2px #82DDFF; }
    var.selected6 { background-color: #FFBCF2; box-shadow: 0 0 0 2px #FFBCF2; }
    </style>
<style>/* style-darkmode */

@media (prefers-color-scheme: dark) {
    :root {
        --text: #ddd;
        --bg: black;

        --unofficial-watermark: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='400'%3E%3Cg fill='%23100808' transform='translate(200 200) rotate(-45) translate(-200 -200)' stroke='%23100808' stroke-width='3'%3E%3Ctext x='50%25' y='220' style='font: bold 70px sans-serif; text-anchor: middle; letter-spacing: 6px;'%3EUNOFFICIAL%3C/text%3E%3Ctext x='50%25' y='305' style='font: bold 70px sans-serif; text-anchor: middle; letter-spacing: 6px;'%3EDRAFT%3C/text%3E%3C/g%3E%3C/svg%3E");

        --logo-bg: #1a5e9a;
        --logo-active-bg: #c00;
        --logo-text: white;

        --tocnav-normal-text: #999;
        --tocnav-normal-bg: var(--bg);
        --tocnav-hover-text: var(--tocnav-normal-text);
        --tocnav-hover-bg: #080808;
        --tocnav-active-text: #f44;
        --tocnav-active-bg: var(--tocnav-normal-bg);

        --tocsidebar-text: var(--text);
        --tocsidebar-bg: #080808;
        --tocsidebar-shadow: rgba(255,255,255,.1);
        --tocsidebar-heading-text: hsla(203,20%,40%,.7);

        --toclink-text: var(--text);
        --toclink-underline: #6af;
        --toclink-visited-text: var(--toclink-text);
        --toclink-visited-underline: #054572;

        --heading-text: #8af;

        --hr-text: var(--text);

        --algo-border: #456;

        --del-text: #f44;
        --del-bg: transparent;
        --ins-text: #4a4;
        --ins-bg: transparent;

        --a-normal-text: #6af;
        --a-normal-underline: #555;
        --a-visited-text: var(--a-normal-text);
        --a-visited-underline: var(--a-normal-underline);
        --a-hover-bg: rgba(25%, 25%, 25%, .2);
        --a-active-text: #f44;
        --a-active-underline: var(--a-active-text);

        --borderedblock-bg: rgba(255, 255, 255, .05);

        --blockquote-border: silver;
        --blockquote-bg: var(--borderedblock-bg);
        --blockquote-text: currentcolor;

        --issue-border: #e05252;
        --issue-bg: var(--borderedblock-bg);
        --issue-text: var(--text);
        --issueheading-text: hsl(0deg, 70%, 70%);

        --example-border: hsl(50deg, 90%, 60%);
        --example-bg: var(--borderedblock-bg);
        --example-text: var(--text);
        --exampleheading-text: hsl(50deg, 70%, 70%);

        --note-border: hsl(120deg, 100%, 35%);
        --note-bg: var(--borderedblock-bg);
        --note-text: var(--text);
        --noteheading-text: hsl(120, 70%, 70%);
        --notesummary-underline: silver;

        --assertion-border: #444;
        --assertion-bg: var(--borderedblock-bg);
        --assertion-text: var(--text);

        --advisement-border: orange;
        --advisement-bg: #222218;
        --advisement-text: var(--text);
        --advisementheading-text: #f84;

        --warning-border: red;
        --warning-bg: hsla(40,100%,20%,0.95);
        --warning-text: var(--text);

        --amendment-border: #330099;
        --amendment-bg: #080010;
        --amendment-text: var(--text);
        --amendmentheading-text: #cc00ff;

        --def-border: #8ccbf2;
        --def-bg: #080818;
        --def-text: var(--text);
        --defrow-border: #136;

        --datacell-border: silver;

        --indexinfo-text: #aaa;

        --indextable-hover-text: var(--text);
        --indextable-hover-bg: #181818;

        --outdatedspec-bg: rgba(255, 255, 255, .5);
        --outdatedspec-text: black;
        --outdated-bg: maroon;
        --outdated-text: white;
        --outdated-shadow: red;

        --editedrec-bg: darkorange;
    }
    /* In case a transparent-bg image doesn't expect to be on a dark bg,
       which is quite common in practice... */
    img { background: white; }
}
@media (prefers-color-scheme: dark) {
    :root {
        --selflink-text: black;
        --selflink-bg: silver;
        --selflink-hover-text: white;
    }
}

@media (prefers-color-scheme: dark) {
    :root {
        --dfnpanel-bg: #222;
        --dfnpanel-text: var(--text);
    }
}
@media (prefers-color-scheme: dark) {
    .highlight:not(.idl) { background: rgba(255, 255, 255, .05); }

    c-[a] { color: #d33682 } /* Keyword.Declaration */
    c-[b] { color: #d33682 } /* Keyword.Type */
    c-[c] { color: #2aa198 } /* Comment */
    c-[d] { color: #2aa198 } /* Comment.Multiline */
    c-[e] { color: #268bd2 } /* Name.Attribute */
    c-[f] { color: #b58900 } /* Name.Tag */
    c-[g] { color: #cb4b16 } /* Name.Variable */
    c-[k] { color: #d33682 } /* Keyword */
    c-[l] { color: #657b83 } /* Literal */
    c-[m] { color: #657b83 } /* Literal.Number */
    c-[n] { color: #268bd2 } /* Name */
    c-[o] { color: #657b83 } /* Operator */
    c-[p] { color: #657b83 } /* Punctuation */
    c-[s] { color: #6c71c4 } /* Literal.String */
    c-[t] { color: #6c71c4 } /* Literal.String.Single */
    c-[u] { color: #6c71c4 } /* Literal.String.Double */
    c-[ch] { color: #2aa198 } /* Comment.Hashbang */
    c-[cp] { color: #2aa198 } /* Comment.Preproc */
    c-[cpf] { color: #2aa198 } /* Comment.PreprocFile */
    c-[c1] { color: #2aa198 } /* Comment.Single */
    c-[cs] { color: #2aa198 } /* Comment.Special */
    c-[kc] { color: #d33682 } /* Keyword.Constant */
    c-[kn] { color: #d33682 } /* Keyword.Namespace */
    c-[kp] { color: #d33682 } /* Keyword.Pseudo */
    c-[kr] { color: #d33682 } /* Keyword.Reserved */
    c-[ld] { color: #657b83 } /* Literal.Date */
    c-[nc] { color: #268bd2 } /* Name.Class */
    c-[no] { color: #268bd2 } /* Name.Constant */
    c-[nd] { color: #268bd2 } /* Name.Decorator */
    c-[ni] { color: #268bd2 } /* Name.Entity */
    c-[ne] { color: #268bd2 } /* Name.Exception */
    c-[nf] { color: #268bd2 } /* Name.Function */
    c-[nl] { color: #268bd2 } /* Name.Label */
    c-[nn] { color: #268bd2 } /* Name.Namespace */
    c-[py] { color: #268bd2 } /* Name.Property */
    c-[ow] { color: #657b83 } /* Operator.Word */
    c-[mb] { color: #657b83 } /* Literal.Number.Bin */
    c-[mf] { color: #657b83 } /* Literal.Number.Float */
    c-[mh] { color: #657b83 } /* Literal.Number.Hex */
    c-[mi] { color: #657b83 } /* Literal.Number.Integer */
    c-[mo] { color: #657b83 } /* Literal.Number.Oct */
    c-[sa] { color: #6c71c4 } /* Literal.String.Affix */
    c-[sb] { color: #6c71c4 } /* Literal.String.Backtick */
    c-[sc] { color: #6c71c4 } /* Literal.String.Char */
    c-[dl] { color: #6c71c4 } /* Literal.String.Delimiter */
    c-[sd] { color: #6c71c4 } /* Literal.String.Doc */
    c-[se] { color: #6c71c4 } /* Literal.String.Escape */
    c-[sh] { color: #6c71c4 } /* Literal.String.Heredoc */
    c-[si] { color: #6c71c4 } /* Literal.String.Interpol */
    c-[sx] { color: #6c71c4 } /* Literal.String.Other */
    c-[sr] { color: #6c71c4 } /* Literal.String.Regex */
    c-[ss] { color: #6c71c4 } /* Literal.String.Symbol */
    c-[fm] { color: #268bd2 } /* Name.Function.Magic */
    c-[vc] { color: #cb4b16 } /* Name.Variable.Class */
    c-[vg] { color: #cb4b16 } /* Name.Variable.Global */
    c-[vi] { color: #cb4b16 } /* Name.Variable.Instance */
    c-[vm] { color: #cb4b16 } /* Name.Variable.Magic */
    c-[il] { color: #657b83 } /* Literal.Number.Integer.Long */
}
</style>
 <body class="h-entry">
  <div class="head">
   <p data-fill-with="logo"><a class="logo" href="https://www.w3.org/"> <img alt="W3C" height="48" src="https://www.w3.org/StyleSheets/TR/2021/logos/W3C" width="72"> </a> </p>
   <h1 class="p-name no-ref" id="title">Page Unload Beacon</h1>
   <p id="w3c-state"><a href="https://www.w3.org/standards/types#UD">Unofficial Proposal Draft</a>, <time class="dt-updated" datetime="2022-07-08">8 July 2022</time></p>
   <details open>
    <summary>More details about this document</summary>
    <div data-fill-with="spec-metadata">
     <dl>
      <dt>This version:
      <dd><a class="u-url" href="http://wicg.github.io/unload-beacon/">http://wicg.github.io/unload-beacon/</a>
      <dt>Issue Tracking:
      <dd><a href="https://github.com/WICG/unload-beacon/issues/">GitHub</a>
      <dd><a href="#issues-index">Inline In Spec</a>
      <dt class="editor">Editor:
      <dd class="editor p-author h-card vcard"><span class="p-name fn">Ian Clelland</span> (<span class="p-org org">Google</span>)
     </dl>
    </div>
   </details>
   <div data-fill-with="warning"></div>
   <p class="copyright" data-fill-with="copyright"><a href="https://www.w3.org/Consortium/Legal/ipr-notice#Copyright">Copyright</a> © 2022 <a href="https://www.w3.org/"><abbr title="World Wide Web Consortium">W3C</abbr></a><sup>®</sup> (<a href="https://www.csail.mit.edu/"><abbr title="Massachusetts Institute of Technology">MIT</abbr></a>, <a href="https://www.ercim.eu/"><abbr title="European Research Consortium for Informatics and Mathematics">ERCIM</abbr></a>, <a href="https://www.keio.ac.jp/">Keio</a>, <a href="https://ev.buaa.edu.cn/">Beihang</a>). W3C <a href="https://www.w3.org/Consortium/Legal/ipr-notice#Legal_Disclaimer">liability</a>, <a href="https://www.w3.org/Consortium/Legal/ipr-notice#W3C_Trademarks">trademark</a> and <a href="https://www.w3.org/Consortium/Legal/2015/copyright-software-and-document" rel="license">permissive document license</a> rules apply. </p>
   <hr title="Separator for header">
  </div>
  <div class="p-summary" data-fill-with="abstract">
   <h2 class="no-num no-toc no-ref heading settled" id="abstract"><span class="content">Abstract</span></h2>
   <p>This document introduces an API for registering data to be sent to a predetermined server

    at the point that a page is unloaded.</p>
  </div>
  <h2 class="no-num no-toc no-ref heading settled" id="sotd"><span class="content">Status of this document</span></h2>
  <div data-fill-with="status">
   <p><em>This section describes the status of this document at the time of its publication.
	A list of current W3C publications
	and the latest revision of this technical report
	can be found in the <a href="https://www.w3.org/TR/">W3C technical reports index at https://www.w3.org/TR/.</a></em> </p>
   <p><a href="https://github.com/WICG/unload-beacon/issues">GitHub Issues</a> are preferred for discussion of this specification. </p>
   <p>This document is governed by the <a href="https://www.w3.org/2021/Process-20211102/" id="w3c_process_revision">2 November 2021 W3C Process Document</a>. </p>
   <p>This document was produced by a group operating under the <a href="https://www.w3.org/Consortium/Patent-Policy/">W3C Patent Policy</a>.
	W3C maintains a <a href="https://www.w3.org/groups/wg/webperf/ipr" rel="disclosure">public list of any patent disclosures</a> made in connection with the deliverables of the group;
	that page also includes instructions for disclosing a patent.
	An individual who has actual knowledge of a patent which the individual believes
	contains <a href="https://www.w3.org/Consortium/Patent-Policy/#def-essential">Essential Claim(s)</a> must disclose the information in accordance with <a href="https://www.w3.org/Consortium/Patent-Policy/#sec-Disclosure">section 6 of the W3C Patent Policy</a>. </p>
   <p></p>
  </div>
  <div data-fill-with="at-risk"></div>
  <nav data-fill-with="table-of-contents" id="toc">
   <h2 class="no-num no-toc no-ref" id="contents">Table of Contents</h2>
   <ol class="toc" role="directory">
    <li><a href="#introduction"><span class="secno">1</span> <span class="content">Introduction</span></a>
    <li>
     <a href="#pending-beacon-framework"><span class="secno">2</span> <span class="content">Pending Beacon Framework</span></a>
     <ol class="toc">
      <li><a href="#concepts"><span class="secno">2.1</span> <span class="content">Concepts</span></a>
      <li><a href="#updating-beacons"><span class="secno">2.2</span> <span class="content">Updating beacons</span></a>
      <li><a href="#sending-beacons"><span class="secno">2.3</span> <span class="content">Sending beacons</span></a>
     </ol>
    <li><a href="#integration"><span class="secno">3</span> <span class="content">Integration with HTML</span></a>
    <li><a href="#pendingbeacon-interface"><span class="secno">4</span> <span class="content">The PendingBeacon interface</span></a>
    <li><a href="#privacy"><span class="secno">5</span> <span class="content">Privacy</span></a>
    <li>
     <a href="#w3c-conformance"><span class="secno"></span> <span class="content">Conformance</span></a>
     <ol class="toc">
      <li><a href="#w3c-conventions"><span class="secno"></span> <span class="content">Document conventions</span></a>
      <li><a href="#w3c-conformant-algorithms"><span class="secno"></span> <span class="content">Conformant Algorithms</span></a>
     </ol>
    <li>
     <a href="#index"><span class="secno"></span> <span class="content">Index</span></a>
     <ol class="toc">
      <li><a href="#index-defined-here"><span class="secno"></span> <span class="content">Terms defined by this specification</span></a>
      <li><a href="#index-defined-elsewhere"><span class="secno"></span> <span class="content">Terms defined by reference</span></a>
     </ol>
    <li>
     <a href="#references"><span class="secno"></span> <span class="content">References</span></a>
     <ol class="toc">
      <li><a href="#normative"><span class="secno"></span> <span class="content">Normative References</span></a>
      <li><a href="#informative"><span class="secno"></span> <span class="content">Informative References</span></a>
     </ol>
    <li><a href="#idl-index"><span class="secno"></span> <span class="content">IDL Index</span></a>
    <li><a href="#issues-index"><span class="secno"></span> <span class="content">Issues Index</span></a>
   </ol>
  </nav>
  <main>
   <h2 class="heading settled" data-level="1" id="introduction"><span class="secno">1. </span><span class="content">Introduction</span><a class="self-link" href="#introduction"></a></h2>
   <p>This is an introduction.</p>
   <p class="issue" id="issue-bee02d4c"><a class="self-link" href="#issue-bee02d4c"></a> This introduction needs to be more of an introduction.</p>
   <h2 class="heading settled" data-level="2" id="pending-beacon-framework"><span class="secno">2. </span><span class="content">Pending Beacon Framework</span><a class="self-link" href="#pending-beacon-framework"></a></h2>
   <h3 class="heading settled" data-level="2.1" id="concepts"><span class="secno">2.1. </span><span class="content">Concepts</span><a class="self-link" href="#concepts"></a></h3>
   <p>A <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="pending-beacon">pending beacon</dfn> represents a piece of data which has been
registered with the user agent for later sending to an origin server.</p>
   <p>A <a data-link-type="dfn" href="#pending-beacon" id="ref-for-pending-beacon">pending beacon</a> has a <dfn class="dfn-paneled" data-dfn-for="pending beacon" data-dfn-type="dfn" data-noexport id="pending-beacon-url">url</dfn>, which is a <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url" id="ref-for-concept-url">URL</a>.</p>
   <p>A <a data-link-type="dfn" href="#pending-beacon" id="ref-for-pending-beacon①">pending beacon</a> has a <dfn class="dfn-paneled" data-dfn-for="pending beacon" data-dfn-type="dfn" data-noexport id="pending-beacon-method">method</dfn>, which is a
string, which is initally <code>"POST"</code>.</p>
   <p>A <a data-link-type="dfn" href="#pending-beacon" id="ref-for-pending-beacon②">pending beacon</a> has a <dfn class="dfn-paneled" data-dfn-for="pending beacon" data-dfn-type="dfn" data-noexport id="pending-beacon-timeout">timeout</dfn>, which is
either null or an integer, and which is initially null.</p>
   <p>A <a data-link-type="dfn" href="#pending-beacon" id="ref-for-pending-beacon③">pending beacon</a> has an <dfn class="dfn-paneled" data-dfn-for="pending beacon" data-dfn-type="dfn" data-noexport id="pending-beacon-is_pending">is_pending</dfn> flag,
which is a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#boolean" id="ref-for-boolean">boolean</a>, which is initially true.</p>
   <p>A <a data-link-type="dfn" href="#pending-beacon" id="ref-for-pending-beacon④">pending beacon</a> has a <dfn class="dfn-paneled" data-dfn-for="pending beacon" data-dfn-type="dfn" data-noexport id="pending-beacon-payload">payload</dfn>, which is a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#byte-sequence" id="ref-for-byte-sequence">byte sequence</a>.  It is initially empty.</p>
   <p>A <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-document" id="ref-for-concept-document">Document</a> has a <dfn class="dfn-paneled" data-dfn-for="Document" data-dfn-type="dfn" data-noexport id="document-pending-beacon-set">pending beacon set</dfn>, which is an <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-set" id="ref-for-ordered-set">ordered set</a> of <a data-link-type="dfn" href="#pending-beacon" id="ref-for-pending-beacon⑤">pending beacons</a>.</p>
   <p class="issue" id="issue-fdb03e89"><a class="self-link" href="#issue-fdb03e89"></a> Add worker beacons as well?</p>
   <p class="note" role="note"><span>Note:</span> In this spec, the <a data-link-type="dfn" href="#document-pending-beacon-set" id="ref-for-document-pending-beacon-set">pending beacon set</a> is associated with a <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-document" id="ref-for-concept-document①">Document</a>.
In an actual implementation, this set will likely need to be stored in the user
agent, separate from the document itself, in order to be able to send beacons
when the document is destroyed (either by being unloaded, or because of a crash).</p>
   <p class="issue" id="issue-a08041ae"><a class="self-link" href="#issue-a08041ae"></a> Define these to be part of the user agent formally.</p>
   <h3 class="heading settled" data-level="2.2" id="updating-beacons"><span class="secno">2.2. </span><span class="content">Updating beacons</span><a class="self-link" href="#updating-beacons"></a></h3>
   <div class="algorithm" data-algorithm="set the url" data-algorithm-for="pending beacon">
     To <dfn class="dfn-paneled" data-dfn-for="pending beacon" data-dfn-type="dfn" data-noexport id="pending-beacon-set-the-url">set the url</dfn> of a pending beacon <var>beacon</var> to a <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url" id="ref-for-concept-url①">URL</a> <var>url</var>: 
    <ol>
     <li data-md>
      <p>If <var>beacon</var>’s <a data-link-type="dfn" href="#pending-beacon-is_pending" id="ref-for-pending-beacon-is_pending">is_pending</a> is false, return false.</p>
     <li data-md>
      <p>If <var>url</var> is not a valid <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url" id="ref-for-concept-url②">URL</a>, return false.</p>
     <li data-md>
      <p>If <var>url</var> is not a <a data-link-type="dfn" href="https://w3c.github.io/webappsec-secure-contexts/#potentially-trustworthy-url" id="ref-for-potentially-trustworthy-url">potentially trustworthy URL</a>, return false.</p>
     <li data-md>
      <p>Set <var>beacon</var>’s <a data-link-type="dfn" href="#pending-beacon-url" id="ref-for-pending-beacon-url">url</a> to <var>url</var>.</p>
     <li data-md>
      <p>Return true.</p>
    </ol>
   </div>
   <div class="algorithm" data-algorithm="set the method" data-algorithm-for="pending beacon">
     To <dfn class="dfn-paneled" data-dfn-for="pending beacon" data-dfn-type="dfn" data-noexport id="pending-beacon-set-the-method">set the method</dfn> of a pending beacon <var>beacon</var> to a string <var>method</var>: 
    <ol>
     <li data-md>
      <p>If <var>beacon</var>’s <a data-link-type="dfn" href="#pending-beacon-is_pending" id="ref-for-pending-beacon-is_pending①">is_pending</a> is false, return false.</p>
     <li data-md>
      <p>If <var>method</var> is not a case-insensitive match for <code>"GET"</code> or <code>"POST"</code>, return false.</p>
     <li data-md>
      <p>Set <var>beacon</var>’s <a data-link-type="dfn" href="#pending-beacon-method" id="ref-for-pending-beacon-method">method</a> to <var>method</var>.</p>
     <li data-md>
      <p>Return true.</p>
    </ol>
   </div>
   <div class="algorithm" data-algorithm="set the timeout" data-algorithm-for="pending beacon">
     To <dfn class="dfn-paneled" data-dfn-for="pending beacon" data-dfn-type="dfn" data-noexport id="pending-beacon-set-the-timeout">set the timeout</dfn> of a pending beacon <var>beacon</var> to an integer <var>timeout</var>: 
    <ol>
     <li data-md>
      <p>If <var>beacon</var>’s <a data-link-type="dfn" href="#pending-beacon-is_pending" id="ref-for-pending-beacon-is_pending②">is_pending</a> is false, return false.</p>
     <li data-md>
      <p>If <var>timeout</var> is negative, return false.</p>
     <li data-md>
      <p>Set <var>beacon</var>’s <a data-link-type="dfn" href="#pending-beacon-timeout" id="ref-for-pending-beacon-timeout">timeout</a> to <var>timeout</var>.</p>
     <li data-md>
      <p>Return true.</p>
    </ol>
   </div>
   <div class="algorithm" data-algorithm="set the payload" data-algorithm-for="pending beacon">
     To <dfn class="dfn-paneled" data-dfn-for="pending beacon" data-dfn-type="dfn" data-noexport id="pending-beacon-set-the-payload">set the payload</dfn> of a pending beacon <var>beacon</var> to a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#byte-sequence" id="ref-for-byte-sequence①">byte sequence</a> <var>payload</var>, 
    <ol>
     <li data-md>
      <p>If <var>beacon</var>’s <a data-link-type="dfn" href="#pending-beacon-is_pending" id="ref-for-pending-beacon-is_pending③">is_pending</a> is false, return false.</p>
     <li data-md>
      <p>Set <var>beacon</var>’s <a data-link-type="dfn" href="#pending-beacon-payload" id="ref-for-pending-beacon-payload">payload</a> to <var>payload</var>.</p>
     <li data-md>
      <p>Return true.</p>
    </ol>
   </div>
   <div class="algorithm" data-algorithm="cancel" data-algorithm-for="pending beacon">
     To <dfn class="dfn-paneled" data-dfn-for="pending beacon" data-dfn-type="dfn" data-noexport id="pending-beacon-cancel">cancel</dfn> a <a data-link-type="dfn" href="#pending-beacon" id="ref-for-pending-beacon⑥">pending beacon</a> <var>beacon</var>, set <var>beacon</var>’s <a data-link-type="dfn" href="#pending-beacon-is_pending" id="ref-for-pending-beacon-is_pending④">is_pending</a> to false. 
    <p class="note" role="note"><span>Note:</span> Once canceled, a <a data-link-type="dfn" href="#pending-beacon" id="ref-for-pending-beacon⑦">pending beacon</a>'s payload will no longer be used,
  and it is safe for a user agent to discard that, and to cancel any associated
  timers. However, other attributes may still be read, and so this algorithm
  does not destroy the beacon itself.</p>
   </div>
   <h3 class="heading settled" data-level="2.3" id="sending-beacons"><span class="secno">2.3. </span><span class="content">Sending beacons</span><a class="self-link" href="#sending-beacons"></a></h3>
   <p class="note" role="note"><span>Note:</span> This is written as though Fetch were used as the underlying mechanism.
However, since these are sent out-of-band, an implementation might not use the
actual web-exposed Fetch API, and may instead use the underlying HTTP primitives
directly.</p>
   <div class="algorithm" data-algorithm="send a document’s beacons">
     To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="send-a-documents-beacons">send a document’s beacons</dfn>, given a Document <var>document</var>, run these steps: 
    <ol>
     <li data-md>
      <p>For each <a data-link-type="dfn" href="#pending-beacon" id="ref-for-pending-beacon⑧">pending beacon</a> <var>beacon</var> in <var>document</var>’s <a data-link-type="dfn" href="#document-pending-beacon-set" id="ref-for-document-pending-beacon-set①">pending beacon set</a>,</p>
      <ol>
       <li data-md>
        <p>Call <a data-link-type="dfn" href="#send-a-queued-pending-beacon" id="ref-for-send-a-queued-pending-beacon">send a queued pending beacon</a> with <var>beacon</var>.</p>
      </ol>
    </ol>
   </div>
   <div class="algorithm" data-algorithm="send a queued pending beacon">
     To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="send-a-queued-pending-beacon">send a queued pending beacon</dfn> <var>beacon</var>, run these steps: 
    <ol>
     <li data-md>
      <p>If <var>beacon</var>’s <a data-link-type="dfn" href="#pending-beacon-is_pending" id="ref-for-pending-beacon-is_pending⑤">is_pending</a> flag is false, then return.</p>
     <li data-md>
      <p>Set <var>beacon</var>’s <a data-link-type="dfn" href="#pending-beacon-is_pending" id="ref-for-pending-beacon-is_pending⑥">is_pending</a> flag to false.</p>
     <li data-md>
      <p>Check permission.</p>
     <li data-md>
      <p>If <var>beacon</var>’s <a data-link-type="dfn" href="#pending-beacon-method" id="ref-for-pending-beacon-method①">method</a> is "GET", then call <a data-link-type="dfn" href="#send-a-pending-beacon-over-get" id="ref-for-send-a-pending-beacon-over-get">send a pending beacon over GET</a> with <var>beacon</var>.</p>
     <li data-md>
      <p>Else call <a data-link-type="dfn" href="#send-a-pending-beacon-over-post" id="ref-for-send-a-pending-beacon-over-post">send a pending beacon over POST</a> with <var>beacon</var>.</p>
    </ol>
    <p class="issue" id="issue-5f980fb4"><a class="self-link" href="#issue-5f980fb4"></a> "Check permission" is not defined. A specific permission should be used
here, and this should integrate with the permissions API.</p>
   </div>
   <div class="algorithm" data-algorithm="send a pending beacon over GET">
     To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="send-a-pending-beacon-over-get">send a pending beacon over GET</dfn>, given a pending beacon <var>beacon</var>: 
    <ol>
     <li data-md>
      <p>Let <var>pairs</var> be the <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list" id="ref-for-list">list</a> « ("data", <var>beacon</var>’s <a data-link-type="dfn" href="#pending-beacon-payload" id="ref-for-pending-beacon-payload①">payload</a>) ».</p>
     <li data-md>
      <p>Let <var>query</var> be the result of running the <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-urlencoded-serializer" id="ref-for-concept-urlencoded-serializer">urlencoded serializer</a> with <var>pairs</var>.</p>
     <li data-md>
      <p>Let <var>url</var> be a clone of <var>beacon</var>’s <a data-link-type="dfn" href="#pending-beacon-url" id="ref-for-pending-beacon-url①">url</a>.</p>
     <li data-md>
      <p>Set <var>url</var>’s query component to <var>query</var>.</p>
     <li data-md>
      <p>Let <var>req</var> be a new <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request" id="ref-for-concept-request">request</a> initialized as follows:</p>
      <dl>
       <dt data-md>method
       <dd data-md>
        <p><code>GET</code></p>
       <dt data-md>client
       <dd data-md>
        <p>The <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#entry-settings-object" id="ref-for-entry-settings-object">entry settings object</a></p>
       <dt data-md>url
       <dd data-md>
        <p><var>url</var></p>
       <dt data-md>credentials mode
       <dd data-md>
        <p>same-origin</p>
      </dl>
     <li data-md>
      <p>Fetch <var>req</var>.</p>
    </ol>
   </div>
   <div class="algorithm" data-algorithm="send a pending beacon over POST">
     To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="send-a-pending-beacon-over-post">send a pending beacon over POST</dfn>, given a pending beacon <var>beacon</var>: 
    <ol>
     <li data-md>
      <p>Let <var>transmittedData</var> be the result of serializing <var>beacon</var>’s <a data-link-type="dfn" href="#pending-beacon-payload" id="ref-for-pending-beacon-payload②">payload</a>.</p>
     <li data-md>
      <p>Let <var>req</var> be a new <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request" id="ref-for-concept-request①">request</a> initialized as follows:</p>
      <dl>
       <dt data-md>method
       <dd data-md>
        <p><code>POST</code></p>
       <dt data-md>client
       <dd data-md>
        <p>The <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#entry-settings-object" id="ref-for-entry-settings-object①">entry settings object</a></p>
       <dt data-md>url
       <dd data-md>
        <p><var>beacon</var>’s <a data-link-type="dfn" href="#pending-beacon-url" id="ref-for-pending-beacon-url②">url</a></p>
       <dt data-md>header list
       <dd data-md>
        <p>headerList</p>
       <dt data-md>origin
       <dd data-md>
        <p>The <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#entry-settings-object" id="ref-for-entry-settings-object②">entry settings object</a>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/origin.html#concept-origin" id="ref-for-concept-origin">origin</a></p>
       <dt data-md>keep-alive flag
       <dd data-md>
        <p>true</p>
       <dt data-md>body
       <dd data-md>
        <p><var>transmittedData</var></p>
       <dt data-md>mode
       <dd data-md>
        <p>cors</p>
       <dt data-md>credentials mode
       <dd data-md>
        <p>same-origin</p>
      </dl>
      <ol>
       <li data-md>
        <p>Fetch <var>req</var>.</p>
      </ol>
    </ol>
    <p class="issue" id="issue-df3133ed"><a class="self-link" href="#issue-df3133ed"></a> headerList is not defined.</p>
   </div>
   <h2 class="heading settled" data-level="3" id="integration"><span class="secno">3. </span><span class="content">Integration with HTML</span><a class="self-link" href="#integration"></a></h2>
   <p class="note" role="note"><span>Note:</span> The following sections modify the <a data-link-type="biblio" href="#biblio-html">[HTML]</a> standard to enable sending of
beacons automatically by the user agent. These should be removed from this spec
as appropriate changes are made to <a data-link-type="biblio" href="#biblio-html">[HTML]</a>.</p>
   <p>When a document with a non-empty <a data-link-type="dfn" href="#document-pending-beacon-set" id="ref-for-document-pending-beacon-set②">pending beacon set</a> is to be discarded, <a data-link-type="dfn" href="#send-a-documents-beacons" id="ref-for-send-a-documents-beacons">send the document’s pending beacons</a>.</p>
   <p class="issue" id="issue-b8b038f0"><a class="self-link" href="#issue-b8b038f0"></a> "discarded" is not well defined.</p>
   <p>When a process hosting a document with a non-empty <a data-link-type="dfn" href="#document-pending-beacon-set" id="ref-for-document-pending-beacon-set③">pending beacon set</a> crashes, <a data-link-type="dfn" href="#send-a-documents-beacons" id="ref-for-send-a-documents-beacons①">send the document’s pending beacons</a>.</p>
   <p class="issue" id="issue-b08b9417"><a class="self-link" href="#issue-b08b9417"></a> The concepts of "process" and "crashes" are not well defined.</p>
   <div class="algorithm" data-algorithm="on visibility state change">
     When a <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-document" id="ref-for-concept-document②">Document</a> <var>document</var> is to become hidden (visibility state change), run these steps: 
    <ol>
     <li data-md>
      <p>For each <a data-link-type="dfn" href="#pending-beacon" id="ref-for-pending-beacon⑨">pending beacon</a> <var>beacon</var> in <var>document</var>’s <a data-link-type="dfn" href="#document-pending-beacon-set" id="ref-for-document-pending-beacon-set④">pending beacon set</a>,</p>
     <li data-md>
      <p>Let <var>timeout</var> be <var>beacon</var>’s <a data-link-type="dfn" href="#pending-beacon-timeout" id="ref-for-pending-beacon-timeout①">timeout</a>.</p>
     <li data-md>
      <p>If <var>timeout</var> is not null, start a timer to run a task in <var>timeout</var> ms.</p>
      <p class="note" role="note"><span>Note:</span> The user agent may choose to coalesce multiple timers in order to send
multiple beacons at the same time.</p>
     <li data-md>
      <p>When the timer expires, call <a data-link-type="dfn" href="#send-a-queued-pending-beacon" id="ref-for-send-a-queued-pending-beacon①">send a queued pending beacon</a> with <var>beacon</var>.</p>
      <p class="note" role="note"><span>Note:</span> The pending beacons may have been sent before this time, in cases
where the document is unloaded, or its hosting process crashes before the
timer fires. In that case, if the user agent still reaches this step, then
the beacons will not be sent again, as their <a data-link-type="dfn" href="#pending-beacon-is_pending" id="ref-for-pending-beacon-is_pending⑦">is_pending</a> flag will be false.</p>
    </ol>
    <p class="issue" id="issue-fa8ec208"><a class="self-link" href="#issue-fa8ec208"></a> "visibility state change" should be more specific here, and should refer
to specific steps in either <a data-link-type="biblio" href="#biblio-page-visibility">[PAGE-VISIBILITY]</a> or <a data-link-type="biblio" href="#biblio-html">[HTML]</a></p>
   </div>
   <h2 class="heading settled" data-level="4" id="pendingbeacon-interface"><span class="secno">4. </span><span class="content">The PendingBeacon interface</span><a class="self-link" href="#pendingbeacon-interface"></a></h2>
<pre class="idl highlight def"><c- b>enum</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="enum" data-export id="enumdef-beaconmethod"><code><c- g>BeaconMethod</c-></code></dfn> {
    <dfn class="idl-code" data-dfn-for="BeaconMethod" data-dfn-type="enum-value" data-export id="dom-beaconmethod-post"><code><c- s>"POST"</c-></code><a class="self-link" href="#dom-beaconmethod-post"></a></dfn>,
    <dfn class="idl-code" data-dfn-for="BeaconMethod" data-dfn-type="enum-value" data-export id="dom-beaconmethod-get"><code><c- s>"GET"</c-></code><a class="self-link" href="#dom-beaconmethod-get"></a></dfn>
};

<c- b>dictionary</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="dictionary" data-export id="dictdef-pendingbeaconoptions"><code><c- g>PendingBeaconOptions</c-></code></dfn> {
    <a data-link-type="idl-name" href="#enumdef-beaconmethod" id="ref-for-enumdef-beaconmethod"><c- n>BeaconMethod</c-></a> <dfn class="dfn-paneled idl-code" data-default="&quot;POST&quot;" data-dfn-for="PendingBeaconOptions" data-dfn-type="dict-member" data-export data-type="BeaconMethod " id="dom-pendingbeaconoptions-method"><code><c- g>method</c-></code></dfn> = "POST";
    <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-unsigned-long" id="ref-for-idl-unsigned-long"><c- b>unsigned</c-> <c- b>long</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="PendingBeaconOptions" data-dfn-type="dict-member" data-export data-type="unsigned long " id="dom-pendingbeaconoptions-pagehidetimeout"><code><c- g>pageHideTimeout</c-></code></dfn>;
};

[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed" id="ref-for-Exposed"><c- g>Exposed</c-></a>=(<c- n>Window</c->, <c- n>Worker</c->)]
<c- b>interface</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="interface" data-export id="pendingbeacon"><code><c- g>PendingBeacon</c-></code></dfn> {
    <a class="idl-code" data-link-type="constructor" href="#dom-pendingbeacon-pendingbeacon" id="ref-for-dom-pendingbeacon-pendingbeacon"><c- g>constructor</c-></a>(<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-USVString" id="ref-for-idl-USVString"><c- b>USVString</c-></a> <dfn class="idl-code" data-dfn-for="PendingBeacon/PendingBeacon(url, options), PendingBeacon/constructor(url, options), PendingBeacon/PendingBeacon(url), PendingBeacon/constructor(url)" data-dfn-type="argument" data-export id="dom-pendingbeacon-pendingbeacon-url-options-url"><code><c- g>url</c-></code><a class="self-link" href="#dom-pendingbeacon-pendingbeacon-url-options-url"></a></dfn>, <c- b>optional</c-> <a data-link-type="idl-name" href="#dictdef-pendingbeaconoptions" id="ref-for-dictdef-pendingbeaconoptions"><c- n>PendingBeaconOptions</c-></a> <dfn class="idl-code" data-dfn-for="PendingBeacon/PendingBeacon(url, options), PendingBeacon/constructor(url, options), PendingBeacon/PendingBeacon(url), PendingBeacon/constructor(url)" data-dfn-type="argument" data-export id="dom-pendingbeacon-pendingbeacon-url-options-options"><code><c- g>options</c-></code><a class="self-link" href="#dom-pendingbeacon-pendingbeacon-url-options-options"></a></dfn> = {});

    <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-USVString" id="ref-for-idl-USVString①"><c- b>USVString</c-></a> <a class="idl-code" data-link-type="attribute" data-type="USVString" href="#dom-pendingbeacon-url" id="ref-for-dom-pendingbeacon-url"><c- g>url</c-></a>;
    <c- b>attribute</c-> <a data-link-type="idl-name" href="#enumdef-beaconmethod" id="ref-for-enumdef-beaconmethod①"><c- n>BeaconMethod</c-></a> <a class="idl-code" data-link-type="attribute" data-type="BeaconMethod" href="#dom-pendingbeacon-method" id="ref-for-dom-pendingbeacon-method"><c- g>method</c-></a>;
    <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-unsigned-long" id="ref-for-idl-unsigned-long①"><c- b>unsigned</c-> <c- b>long</c-></a> <a class="idl-code" data-link-type="attribute" data-type="unsigned long" href="#dom-pendingbeacon-pagehidetimeout" id="ref-for-dom-pendingbeacon-pagehidetimeout"><c- g>pageHideTimeout</c-></a>;
    <c- b>readonly</c-> <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-boolean" id="ref-for-idl-boolean"><c- b>boolean</c-></a> <a class="idl-code" data-link-type="attribute" data-readonly data-type="boolean" href="#dom-pendingbeacon-ispending" id="ref-for-dom-pendingbeacon-ispending"><c- g>isPending</c-></a>;

    <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-undefined" id="ref-for-idl-undefined"><c- b>undefined</c-></a> <a class="idl-code" data-link-type="method" href="#dom-pendingbeacon-deactivate" id="ref-for-dom-pendingbeacon-deactivate"><c- g>deactivate</c-></a>();
    <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-undefined" id="ref-for-idl-undefined①"><c- b>undefined</c-></a> <a class="idl-code" data-link-type="method" href="#dom-pendingbeacon-setdata" id="ref-for-dom-pendingbeacon-setdata"><c- g>setData</c-></a>(<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-object" id="ref-for-idl-object"><c- b>object</c-></a> <dfn class="idl-code" data-dfn-for="PendingBeacon/setData(data)" data-dfn-type="argument" data-export id="dom-pendingbeacon-setdata-data-data"><code><c- g>data</c-></code><a class="self-link" href="#dom-pendingbeacon-setdata-data-data"></a></dfn>);
    <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-undefined" id="ref-for-idl-undefined②"><c- b>undefined</c-></a> <a class="idl-code" data-link-type="method" href="#dom-pendingbeacon-sendnow" id="ref-for-dom-pendingbeacon-sendnow"><c- g>sendNow</c-></a>();
};
</pre>
   <p>A <code class="idl"><a data-link-type="idl" href="#pendingbeacon" id="ref-for-pendingbeacon">PendingBeacon</a></code> object has an associated <dfn class="dfn-paneled" data-dfn-for="PendingBeacon" data-dfn-type="dfn" data-noexport id="pendingbeacon-beacon">beacon</dfn>, which is a <a data-link-type="dfn" href="#pending-beacon" id="ref-for-pending-beacon①⓪">pending beacon</a>.</p>
   <div class="algorithm" data-algorithm="PendingBeacon(url, options)" data-algorithm-for="PendingBeacon">
     The <dfn class="dfn-paneled idl-code" data-dfn-for="PendingBeacon" data-dfn-type="constructor" data-export data-lt="PendingBeacon(url, options)|constructor(url, options)|PendingBeacon(url)|constructor(url)" id="dom-pendingbeacon-pendingbeacon"><code>new PendingBeacon(<var>url</var>, <var>options</var>)</code></dfn> steps are: 
    <ol>
     <li data-md>
      <p>Let <var>beacon</var> be a new <a data-link-type="dfn" href="#pending-beacon" id="ref-for-pending-beacon①①">pending beacon</a>.</p>
     <li data-md>
      <p>Set <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this" id="ref-for-this">this</a>'s <a data-link-type="dfn" href="#pendingbeacon-beacon" id="ref-for-pendingbeacon-beacon">beacon</a> to <var>beacon</var>.</p>
     <li data-md>
      <p>Set <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this" id="ref-for-this①">this</a>'s <code class="idl"><a data-link-type="idl" href="#dom-pendingbeacon-url" id="ref-for-dom-pendingbeacon-url①">url</a></code> to <var>url</var>.</p>
     <li data-md>
      <p>If <var>options</var> has a <code class="idl"><a data-link-type="idl" href="#dom-pendingbeaconoptions-method" id="ref-for-dom-pendingbeaconoptions-method">method</a></code> member, then set <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this" id="ref-for-this②">this</a>'s <code class="idl"><a data-link-type="idl" href="#dom-pendingbeacon-method" id="ref-for-dom-pendingbeacon-method①">method</a></code> to <var>options</var>’s <code class="idl"><a data-link-type="idl" href="#dom-pendingbeaconoptions-method" id="ref-for-dom-pendingbeaconoptions-method①">method</a></code>.</p>
     <li data-md>
      <p>If <var>options</var> has a <code class="idl"><a data-link-type="idl" href="#dom-pendingbeaconoptions-pagehidetimeout" id="ref-for-dom-pendingbeaconoptions-pagehidetimeout">pageHideTimeout</a></code> member, then set <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this" id="ref-for-this③">this</a>'s <code class="idl"><a data-link-type="idl" href="#dom-pendingbeacon-pagehidetimeout" id="ref-for-dom-pendingbeacon-pagehidetimeout①">pageHideTimeout</a></code> to <var>options</var>’s <code class="idl"><a data-link-type="idl" href="#dom-pendingbeaconoptions-pagehidetimeout" id="ref-for-dom-pendingbeaconoptions-pagehidetimeout①">pageHideTimeout</a></code>.</p>
     <li data-md>
      <p>Insert <var>beacon</var> into the user agent’s pending beacon set.</p>
    </ol>
   </div>
   <div class="algorithm" data-algorithm="url" data-algorithm-for="PendingBeacon"> The <dfn class="dfn-paneled idl-code" data-dfn-for="PendingBeacon" data-dfn-type="attribute" data-export id="dom-pendingbeacon-url"><code>url</code></dfn> getter steps are to return <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this" id="ref-for-this④">this</a>'s <a data-link-type="dfn" href="#pendingbeacon-beacon" id="ref-for-pendingbeacon-beacon①">beacon</a>'s <a data-link-type="dfn" href="#pending-beacon-url" id="ref-for-pending-beacon-url③">url</a>. </div>
   <div class="algorithm" data-algorithm="set url" data-algorithm-for="PendingBeacon">
     The <code class="idl"><a data-link-type="idl" href="#dom-pendingbeacon-url" id="ref-for-dom-pendingbeacon-url②">url</a></code> setter steps are: 
    <ol>
     <li data-md>
      <p>Let <var>beacon</var> be <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this" id="ref-for-this⑤">this</a>'s <a data-link-type="dfn" href="#pendingbeacon-beacon" id="ref-for-pendingbeacon-beacon②">beacon</a>.</p>
     <li data-md>
      <p>If <var>beacon</var>’s <a data-link-type="dfn" href="#pending-beacon-is_pending" id="ref-for-pending-beacon-is_pending⑧">is_pending</a> is not true, throw a <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#nomodificationallowederror" id="ref-for-nomodificationallowederror">"NoModificationAllowedError"</a></code> <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-DOMException" id="ref-for-idl-DOMException">DOMException</a></code>.</p>
     <li data-md>
      <p>Let <var>urlString</var> be the argument to the setter.</p>
     <li data-md>
      <p>If <var>urlString</var> is not a <a data-link-type="dfn" href="https://url.spec.whatwg.org/#valid-url-string" id="ref-for-valid-url-string">valid URL string</a>, throw a <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#exceptiondef-typeerror" id="ref-for-exceptiondef-typeerror">TypeError</a></code>.</p>
     <li data-md>
      <p>Let <var>base</var> be the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#entry-settings-object" id="ref-for-entry-settings-object③">entry settings object</a>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#api-base-url" id="ref-for-api-base-url">API base URL</a>.</p>
     <li data-md>
      <p>Let <var>url</var> be the result of running the <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-parser" id="ref-for-concept-url-parser">URL parser</a> on <var>urlString</var> and <var>base</var>.</p>
     <li data-md>
      <p>If <var>url</var> is failure, throw a <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#exceptiondef-typeerror" id="ref-for-exceptiondef-typeerror①">TypeError</a></code>.</p>
     <li data-md>
      <p>If the result of <a data-link-type="dfn" href="#pending-beacon-set-the-url" id="ref-for-pending-beacon-set-the-url">setting</a> <var>beacon</var>’s <a data-link-type="dfn" href="#pending-beacon-url" id="ref-for-pending-beacon-url④">url</a> to <var>url</var> is false, throw a <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#exceptiondef-typeerror" id="ref-for-exceptiondef-typeerror②">TypeError</a></code>.</p>
    </ol>
   </div>
   <div class="algorithm" data-algorithm="method" data-algorithm-for="PendingBeacon"> The <dfn class="dfn-paneled idl-code" data-dfn-for="PendingBeacon" data-dfn-type="attribute" data-export id="dom-pendingbeacon-method"><code>method</code></dfn> getter steps are to return <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this" id="ref-for-this⑥">this</a>'s <a data-link-type="dfn" href="#pendingbeacon-beacon" id="ref-for-pendingbeacon-beacon③">beacon</a>'s <a data-link-type="dfn" href="#pending-beacon-method" id="ref-for-pending-beacon-method②">method</a>. </div>
   <div class="algorithm" data-algorithm="set method" data-algorithm-for="PendingBeacon">
     The <code class="idl"><a data-link-type="idl" href="#dom-pendingbeacon-method" id="ref-for-dom-pendingbeacon-method②">method</a></code> setter steps are: 
    <ol>
     <li data-md>
      <p>Let <var>beacon</var> be <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this" id="ref-for-this⑦">this</a>'s <a data-link-type="dfn" href="#pendingbeacon-beacon" id="ref-for-pendingbeacon-beacon④">beacon</a>.</p>
     <li data-md>
      <p>If <var>beacon</var>’s <a data-link-type="dfn" href="#pending-beacon-is_pending" id="ref-for-pending-beacon-is_pending⑨">is_pending</a> is not true, throw a <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#nomodificationallowederror" id="ref-for-nomodificationallowederror①">"NoModificationAllowedError"</a></code> <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-DOMException" id="ref-for-idl-DOMException①">DOMException</a></code>.</p>
     <li data-md>
      <p>Let <var>method</var> be the argument to the setter.</p>
     <li data-md>
      <p>If the result of <a data-link-type="dfn" href="#pending-beacon-set-the-method" id="ref-for-pending-beacon-set-the-method">setting</a> <var>beacon</var>’s <a data-link-type="dfn" href="#pending-beacon-method" id="ref-for-pending-beacon-method③">method</a> to <var>method</var> is false, throw a <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#exceptiondef-typeerror" id="ref-for-exceptiondef-typeerror③">TypeError</a></code>.</p>
    </ol>
   </div>
   <div class="algorithm" data-algorithm="pageHideTimeout" data-algorithm-for="PendingBeacon"> The <dfn class="dfn-paneled idl-code" data-dfn-for="PendingBeacon" data-dfn-type="attribute" data-export id="dom-pendingbeacon-pagehidetimeout"><code>pageHideTimeout</code></dfn> getter steps are to return <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this" id="ref-for-this⑧">this</a>'s <a data-link-type="dfn" href="#pendingbeacon-beacon" id="ref-for-pendingbeacon-beacon⑤">beacon</a>'s <a data-link-type="dfn" href="#pending-beacon-timeout" id="ref-for-pending-beacon-timeout②">timeout</a>. </div>
   <div class="algorithm" data-algorithm="set pageHideTimeout" data-algorithm-for="PendingBeacon">
     The <code class="idl"><a data-link-type="idl" href="#dom-pendingbeacon-pagehidetimeout" id="ref-for-dom-pendingbeacon-pagehidetimeout②">pageHideTimeout</a></code> setter steps are: 
    <ol>
     <li data-md>
      <p>Let <var>beacon</var> be <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this" id="ref-for-this⑨">this</a>'s <a data-link-type="dfn" href="#pendingbeacon-beacon" id="ref-for-pendingbeacon-beacon⑥">beacon</a>.</p>
     <li data-md>
      <p>If <var>beacon</var>’s <a data-link-type="dfn" href="#pending-beacon-is_pending" id="ref-for-pending-beacon-is_pending①⓪">is_pending</a> is not true, throw a <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#nomodificationallowederror" id="ref-for-nomodificationallowederror②">"NoModificationAllowedError"</a></code> <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-DOMException" id="ref-for-idl-DOMException②">DOMException</a></code>.</p>
     <li data-md>
      <p>Let <var>timeout</var> be the argument to the setter.</p>
     <li data-md>
      <p>If <var>timeout</var> is not a non-negative integer, throw a <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#exceptiondef-typeerror" id="ref-for-exceptiondef-typeerror④">TypeError</a></code>.</p>
     <li data-md>
      <p>If the result of <a data-link-type="dfn" href="#pending-beacon-set-the-timeout" id="ref-for-pending-beacon-set-the-timeout">setting</a> <var>beacon</var>’s <a data-link-type="dfn" href="#pending-beacon-timeout" id="ref-for-pending-beacon-timeout③">timeout</a> to <var>timeout</var> is false, throw a <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#exceptiondef-typeerror" id="ref-for-exceptiondef-typeerror⑤">TypeError</a></code>.</p>
    </ol>
   </div>
   <div class="algorithm" data-algorithm="isPending" data-algorithm-for="PendingBeacon"> The <dfn class="dfn-paneled idl-code" data-dfn-for="PendingBeacon" data-dfn-type="attribute" data-export id="dom-pendingbeacon-ispending"><code>isPending</code></dfn> getter steps are to return <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this" id="ref-for-this①⓪">this</a>'s <a data-link-type="dfn" href="#pendingbeacon-beacon" id="ref-for-pendingbeacon-beacon⑦">beacon</a>'s <a data-link-type="dfn" href="#pending-beacon-is_pending" id="ref-for-pending-beacon-is_pending①①">is_pending</a> flag. </div>
   <div class="algorithm" data-algorithm="deactivate()" data-algorithm-for="PendingBeacon">
     The <dfn class="dfn-paneled idl-code" data-dfn-for="PendingBeacon" data-dfn-type="method" data-export id="dom-pendingbeacon-deactivate"><code>deactivate()</code></dfn> steps are: 
    <ol>
     <li data-md>
      <p>Let <var>beacon</var> be <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this" id="ref-for-this①①">this</a>'s <a data-link-type="dfn" href="#pendingbeacon-beacon" id="ref-for-pendingbeacon-beacon⑧">beacon</a>.</p>
     <li data-md>
      <p>If <var>beacon</var>’s <a data-link-type="dfn" href="#pending-beacon-is_pending" id="ref-for-pending-beacon-is_pending①②">is_pending</a> is not true, throw an <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#invalidstateerror" id="ref-for-invalidstateerror">"InvalidStateError"</a></code> <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-DOMException" id="ref-for-idl-DOMException③">DOMException</a></code>.</p>
     <li data-md>
      <p><a data-link-type="dfn" href="#pending-beacon-cancel" id="ref-for-pending-beacon-cancel">cancel</a> <var>beacon</var>.</p>
    </ol>
   </div>
   <div class="algorithm" data-algorithm="setData(data)" data-algorithm-for="PendingBeacon">
     The <dfn class="dfn-paneled idl-code" data-dfn-for="PendingBeacon" data-dfn-type="method" data-export id="dom-pendingbeacon-setdata"><code>setData(<var>data</var>)</code></dfn> steps are: 
    <ol>
     <li data-md>
      <p>Let <var>beacon</var> be <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this" id="ref-for-this①②">this</a>'s <a data-link-type="dfn" href="#pendingbeacon-beacon" id="ref-for-pendingbeacon-beacon⑨">beacon</a>.</p>
     <li data-md>
      <p>If <var>beacon</var>’s <a data-link-type="dfn" href="#pending-beacon-is_pending" id="ref-for-pending-beacon-is_pending①③">is_pending</a> is not true, throw a <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#nomodificationallowederror" id="ref-for-nomodificationallowederror③">"NoModificationAllowedError"</a></code> <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-DOMException" id="ref-for-idl-DOMException④">DOMException</a></code>.</p>
     <li data-md>
      <p>Let (<var>body</var>, <var>contentType</var>) be the result of <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-bodyinit-extract" id="ref-for-concept-bodyinit-extract">extracting</a> a <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#body-with-type" id="ref-for-body-with-type">body with type</a> from <var>data</var> with keepalive set to true.</p>
     <li data-md>
      <p>Let <var>bytes</var> be the <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#byte-sequence" id="ref-for-byte-sequence②">byte sequence</a> obtained by reading <var>body</var>’s stream.</p>
     <li data-md>
      <p>If the result of <a data-link-type="dfn" href="#pending-beacon-set-the-payload" id="ref-for-pending-beacon-set-the-payload">setting</a> <var>beacon</var>’s <a data-link-type="dfn" href="#pending-beacon-payload" id="ref-for-pending-beacon-payload③">payload</a> to <var>bytes</var> is false, throw a <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#exceptiondef-typeerror" id="ref-for-exceptiondef-typeerror⑥">TypeError</a></code>.</p>
    </ol>
   </div>
   <div class="algorithm" data-algorithm="sendNow()" data-algorithm-for="PendingBeacon">
     The <dfn class="dfn-paneled idl-code" data-dfn-for="PendingBeacon" data-dfn-type="method" data-export id="dom-pendingbeacon-sendnow"><code>sendNow()</code></dfn> steps are: 
    <ol>
     <li data-md>
      <p>Let <var>beacon</var> be <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#this" id="ref-for-this①③">this</a>'s <a data-link-type="dfn" href="#pendingbeacon-beacon" id="ref-for-pendingbeacon-beacon①⓪">beacon</a>.</p>
     <li data-md>
      <p>If <var>beacon</var>’s <a data-link-type="dfn" href="#pending-beacon-is_pending" id="ref-for-pending-beacon-is_pending①④">is_pending</a> is not true, throw an <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#invalidstateerror" id="ref-for-invalidstateerror①">"InvalidStateError"</a></code> <code class="idl"><a data-link-type="idl" href="https://webidl.spec.whatwg.org/#idl-DOMException" id="ref-for-idl-DOMException⑤">DOMException</a></code>.</p>
     <li data-md>
      <p>Call <a data-link-type="dfn" href="#send-a-queued-pending-beacon" id="ref-for-send-a-queued-pending-beacon②">send a queued pending beacon</a> with <var>beacon</var>.</p>
    </ol>
   </div>
   <h2 class="heading settled" data-level="5" id="privacy"><span class="secno">5. </span><span class="content">Privacy</span><a class="self-link" href="#privacy"></a></h2>
   <p class="issue" id="issue-f9fb6d4e"><a class="self-link" href="#issue-f9fb6d4e"></a> This section is woefully incomplete. These all need to be fleshed out in
enough detail to accurately describe the privacy issues and suggested or
prescribed mitigations.</p>
   <ul>
    <li data-md>
     <p>When the network changes, drop all queued beacons</p>
    <li data-md>
     <p>Clear-site-data?</p>
    <li data-md>
     <p>Incognito?</p>
   </ul>
  </main>
  <div data-fill-with="conformance">
   <h2 class="no-ref no-num heading settled" id="w3c-conformance"><span class="content">Conformance</span><a class="self-link" href="#w3c-conformance"></a></h2>
   <h3 class="no-ref no-num heading settled" id="w3c-conventions"><span class="content">Document conventions</span><a class="self-link" href="#w3c-conventions"></a></h3>
   <p>Conformance requirements are expressed
    with a combination of descriptive assertions
    and RFC 2119 terminology.
    The key words “MUST”, “MUST NOT”, “REQUIRED”, “SHALL”, “SHALL NOT”, “SHOULD”, “SHOULD NOT”, “RECOMMENDED”, “MAY”, and “OPTIONAL”
    in the normative parts of this document
    are to be interpreted as described in RFC 2119.
    However, for readability,
    these words do not appear in all uppercase letters in this specification. </p>
   <p>All of the text of this specification is normative
    except sections explicitly marked as non-normative, examples, and notes. <a data-link-type="biblio" href="#biblio-rfc2119">[RFC2119]</a> </p>
   <p>Examples in this specification are introduced with the words “for example”
    or are set apart from the normative text
    with <code>class="example"</code>,
    like this: </p>
   <div class="example" id="w3c-example">
    <a class="self-link" href="#w3c-example"></a> 
    <p>This is an example of an informative example. </p>
   </div>
   <p>Informative notes begin with the word “Note”
    and are set apart from the normative text
    with <code>class="note"</code>,
    like this: </p>
   <p class="note" role="note">Note, this is an informative note. </p>
   <h3 class="no-ref no-num heading settled" id="w3c-conformant-algorithms"><span class="content">Conformant Algorithms</span><a class="self-link" href="#w3c-conformant-algorithms"></a></h3>
   <p>Requirements phrased in the imperative as part of algorithms
    (such as "strip any leading space characters"
    or "return false and abort these steps")
    are to be interpreted with the meaning of the key word
    ("must", "should", "may", etc)
    used in introducing the algorithm. </p>
   <p>Conformance requirements phrased as algorithms or specific steps
    can be implemented in any manner,
    so long as the end result is equivalent.
    In particular, the algorithms defined in this specification
    are intended to be easy to understand
    and are not intended to be performant.
    Implementers are encouraged to optimize. </p>
  </div>
<script src="https://www.w3.org/scripts/TR/2021/fixup.js"></script>
  <h2 class="no-num no-ref heading settled" id="index"><span class="content">Index</span><a class="self-link" href="#index"></a></h2>
  <h3 class="no-num no-ref heading settled" id="index-defined-here"><span class="content">Terms defined by this specification</span><a class="self-link" href="#index-defined-here"></a></h3>
  <ul class="index">
   <li><a href="#pendingbeacon-beacon">beacon</a><span>, in § 4</span>
   <li><a href="#enumdef-beaconmethod">BeaconMethod</a><span>, in § 4</span>
   <li><a href="#pending-beacon-cancel">cancel</a><span>, in § 2.2</span>
   <li><a href="#dom-pendingbeacon-pendingbeacon">constructor(url)</a><span>, in § 4</span>
   <li><a href="#dom-pendingbeacon-pendingbeacon">constructor(url, options)</a><span>, in § 4</span>
   <li><a href="#dom-pendingbeacon-deactivate">deactivate()</a><span>, in § 4</span>
   <li><a href="#dom-beaconmethod-get">"GET"</a><span>, in § 4</span>
   <li><a href="#pending-beacon-is_pending">is_pending</a><span>, in § 2.1</span>
   <li><a href="#dom-pendingbeacon-ispending">isPending</a><span>, in § 4</span>
   <li>
    method
    <ul>
     <li><a href="#dom-pendingbeacon-method">attribute for PendingBeacon</a><span>, in § 4</span>
     <li><a href="#pending-beacon-method">dfn for pending beacon</a><span>, in § 2.1</span>
     <li><a href="#dom-pendingbeaconoptions-method">dict-member for PendingBeaconOptions</a><span>, in § 4</span>
    </ul>
   <li>
    pageHideTimeout
    <ul>
     <li><a href="#dom-pendingbeacon-pagehidetimeout">attribute for PendingBeacon</a><span>, in § 4</span>
     <li><a href="#dom-pendingbeaconoptions-pagehidetimeout">dict-member for PendingBeaconOptions</a><span>, in § 4</span>
    </ul>
   <li><a href="#pending-beacon-payload">payload</a><span>, in § 2.1</span>
   <li><a href="#pending-beacon">pending beacon</a><span>, in § 2.1</span>
   <li><a href="#pendingbeacon">PendingBeacon</a><span>, in § 4</span>
   <li><a href="#dictdef-pendingbeaconoptions">PendingBeaconOptions</a><span>, in § 4</span>
   <li><a href="#document-pending-beacon-set">pending beacon set</a><span>, in § 2.1</span>
   <li><a href="#dom-pendingbeacon-pendingbeacon">PendingBeacon(url)</a><span>, in § 4</span>
   <li><a href="#dom-pendingbeacon-pendingbeacon">PendingBeacon(url, options)</a><span>, in § 4</span>
   <li><a href="#dom-beaconmethod-post">"POST"</a><span>, in § 4</span>
   <li><a href="#send-a-documents-beacons">send a document’s beacons</a><span>, in § 2.3</span>
   <li><a href="#send-a-pending-beacon-over-get">send a pending beacon over GET</a><span>, in § 2.3</span>
   <li><a href="#send-a-pending-beacon-over-post">send a pending beacon over POST</a><span>, in § 2.3</span>
   <li><a href="#send-a-queued-pending-beacon">send a queued pending beacon</a><span>, in § 2.3</span>
   <li><a href="#dom-pendingbeacon-sendnow">sendNow()</a><span>, in § 4</span>
   <li><a href="#dom-pendingbeacon-setdata">setData(data)</a><span>, in § 4</span>
   <li><a href="#pending-beacon-set-the-method">set the method</a><span>, in § 2.2</span>
   <li><a href="#pending-beacon-set-the-payload">set the payload</a><span>, in § 2.2</span>
   <li><a href="#pending-beacon-set-the-timeout">set the timeout</a><span>, in § 2.2</span>
   <li><a href="#pending-beacon-set-the-url">set the url</a><span>, in § 2.2</span>
   <li><a href="#pending-beacon-timeout">timeout</a><span>, in § 2.1</span>
   <li>
    url
    <ul>
     <li><a href="#dom-pendingbeacon-url">attribute for PendingBeacon</a><span>, in § 4</span>
     <li><a href="#pending-beacon-url">dfn for pending beacon</a><span>, in § 2.1</span>
    </ul>
  </ul>
  <aside class="dfn-panel" data-for="term-for-concept-document">
   <a href="https://dom.spec.whatwg.org/#concept-document">https://dom.spec.whatwg.org/#concept-document</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-document">2.1. Concepts</a> <a href="#ref-for-concept-document①">(2)</a>
    <li><a href="#ref-for-concept-document②">3. Integration with HTML</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-body-with-type">
   <a href="https://fetch.spec.whatwg.org/#body-with-type">https://fetch.spec.whatwg.org/#body-with-type</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-body-with-type">4. The PendingBeacon interface</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-bodyinit-extract">
   <a href="https://fetch.spec.whatwg.org/#concept-bodyinit-extract">https://fetch.spec.whatwg.org/#concept-bodyinit-extract</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-bodyinit-extract">4. The PendingBeacon interface</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-request">
   <a href="https://fetch.spec.whatwg.org/#concept-request">https://fetch.spec.whatwg.org/#concept-request</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-request">2.3. Sending beacons</a> <a href="#ref-for-concept-request①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-api-base-url">
   <a href="https://html.spec.whatwg.org/multipage/webappapis.html#api-base-url">https://html.spec.whatwg.org/multipage/webappapis.html#api-base-url</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-api-base-url">4. The PendingBeacon interface</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-entry-settings-object">
   <a href="https://html.spec.whatwg.org/multipage/webappapis.html#entry-settings-object">https://html.spec.whatwg.org/multipage/webappapis.html#entry-settings-object</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-entry-settings-object">2.3. Sending beacons</a> <a href="#ref-for-entry-settings-object①">(2)</a> <a href="#ref-for-entry-settings-object②">(3)</a>
    <li><a href="#ref-for-entry-settings-object③">4. The PendingBeacon interface</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-origin">
   <a href="https://html.spec.whatwg.org/multipage/origin.html#concept-origin">https://html.spec.whatwg.org/multipage/origin.html#concept-origin</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-origin">2.3. Sending beacons</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-boolean">
   <a href="https://infra.spec.whatwg.org/#boolean">https://infra.spec.whatwg.org/#boolean</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-boolean">2.1. Concepts</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-byte-sequence">
   <a href="https://infra.spec.whatwg.org/#byte-sequence">https://infra.spec.whatwg.org/#byte-sequence</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-byte-sequence">2.1. Concepts</a>
    <li><a href="#ref-for-byte-sequence①">2.2. Updating beacons</a>
    <li><a href="#ref-for-byte-sequence②">4. The PendingBeacon interface</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-list">
   <a href="https://infra.spec.whatwg.org/#list">https://infra.spec.whatwg.org/#list</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-list">2.3. Sending beacons</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-ordered-set">
   <a href="https://infra.spec.whatwg.org/#ordered-set">https://infra.spec.whatwg.org/#ordered-set</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-ordered-set">2.1. Concepts</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-potentially-trustworthy-url">
   <a href="https://w3c.github.io/webappsec-secure-contexts/#potentially-trustworthy-url">https://w3c.github.io/webappsec-secure-contexts/#potentially-trustworthy-url</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-potentially-trustworthy-url">2.2. Updating beacons</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-url">
   <a href="https://url.spec.whatwg.org/#concept-url">https://url.spec.whatwg.org/#concept-url</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-url">2.1. Concepts</a>
    <li><a href="#ref-for-concept-url①">2.2. Updating beacons</a> <a href="#ref-for-concept-url②">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-url-parser">
   <a href="https://url.spec.whatwg.org/#concept-url-parser">https://url.spec.whatwg.org/#concept-url-parser</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-url-parser">4. The PendingBeacon interface</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-urlencoded-serializer">
   <a href="https://url.spec.whatwg.org/#concept-urlencoded-serializer">https://url.spec.whatwg.org/#concept-urlencoded-serializer</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-urlencoded-serializer">2.3. Sending beacons</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-valid-url-string">
   <a href="https://url.spec.whatwg.org/#valid-url-string">https://url.spec.whatwg.org/#valid-url-string</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-valid-url-string">4. The PendingBeacon interface</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-idl-DOMException">
   <a href="https://webidl.spec.whatwg.org/#idl-DOMException">https://webidl.spec.whatwg.org/#idl-DOMException</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-idl-DOMException">4. The PendingBeacon interface</a> <a href="#ref-for-idl-DOMException①">(2)</a> <a href="#ref-for-idl-DOMException②">(3)</a> <a href="#ref-for-idl-DOMException③">(4)</a> <a href="#ref-for-idl-DOMException④">(5)</a> <a href="#ref-for-idl-DOMException⑤">(6)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-Exposed">
   <a href="https://webidl.spec.whatwg.org/#Exposed">https://webidl.spec.whatwg.org/#Exposed</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-Exposed">4. The PendingBeacon interface</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-invalidstateerror">
   <a href="https://webidl.spec.whatwg.org/#invalidstateerror">https://webidl.spec.whatwg.org/#invalidstateerror</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-invalidstateerror">4. The PendingBeacon interface</a> <a href="#ref-for-invalidstateerror①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-nomodificationallowederror">
   <a href="https://webidl.spec.whatwg.org/#nomodificationallowederror">https://webidl.spec.whatwg.org/#nomodificationallowederror</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-nomodificationallowederror">4. The PendingBeacon interface</a> <a href="#ref-for-nomodificationallowederror①">(2)</a> <a href="#ref-for-nomodificationallowederror②">(3)</a> <a href="#ref-for-nomodificationallowederror③">(4)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-exceptiondef-typeerror">
   <a href="https://webidl.spec.whatwg.org/#exceptiondef-typeerror">https://webidl.spec.whatwg.org/#exceptiondef-typeerror</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-exceptiondef-typeerror">4. The PendingBeacon interface</a> <a href="#ref-for-exceptiondef-typeerror①">(2)</a> <a href="#ref-for-exceptiondef-typeerror②">(3)</a> <a href="#ref-for-exceptiondef-typeerror③">(4)</a> <a href="#ref-for-exceptiondef-typeerror④">(5)</a> <a href="#ref-for-exceptiondef-typeerror⑤">(6)</a> <a href="#ref-for-exceptiondef-typeerror⑥">(7)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-idl-USVString">
   <a href="https://webidl.spec.whatwg.org/#idl-USVString">https://webidl.spec.whatwg.org/#idl-USVString</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-idl-USVString">4. The PendingBeacon interface</a> <a href="#ref-for-idl-USVString①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-idl-boolean">
   <a href="https://webidl.spec.whatwg.org/#idl-boolean">https://webidl.spec.whatwg.org/#idl-boolean</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-idl-boolean">4. The PendingBeacon interface</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-idl-object">
   <a href="https://webidl.spec.whatwg.org/#idl-object">https://webidl.spec.whatwg.org/#idl-object</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-idl-object">4. The PendingBeacon interface</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-this">
   <a href="https://webidl.spec.whatwg.org/#this">https://webidl.spec.whatwg.org/#this</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-this">4. The PendingBeacon interface</a> <a href="#ref-for-this①">(2)</a> <a href="#ref-for-this②">(3)</a> <a href="#ref-for-this③">(4)</a> <a href="#ref-for-this④">(5)</a> <a href="#ref-for-this⑤">(6)</a> <a href="#ref-for-this⑥">(7)</a> <a href="#ref-for-this⑦">(8)</a> <a href="#ref-for-this⑧">(9)</a> <a href="#ref-for-this⑨">(10)</a> <a href="#ref-for-this①⓪">(11)</a> <a href="#ref-for-this①①">(12)</a> <a href="#ref-for-this①②">(13)</a> <a href="#ref-for-this①③">(14)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-idl-undefined">
   <a href="https://webidl.spec.whatwg.org/#idl-undefined">https://webidl.spec.whatwg.org/#idl-undefined</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-idl-undefined">4. The PendingBeacon interface</a> <a href="#ref-for-idl-undefined①">(2)</a> <a href="#ref-for-idl-undefined②">(3)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-idl-unsigned-long">
   <a href="https://webidl.spec.whatwg.org/#idl-unsigned-long">https://webidl.spec.whatwg.org/#idl-unsigned-long</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-idl-unsigned-long">4. The PendingBeacon interface</a> <a href="#ref-for-idl-unsigned-long①">(2)</a>
   </ul>
  </aside>
  <h3 class="no-num no-ref heading settled" id="index-defined-elsewhere"><span class="content">Terms defined by reference</span><a class="self-link" href="#index-defined-elsewhere"></a></h3>
  <ul class="index">
   <li>
    <a data-link-type="biblio">[DOM]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-concept-document">document</span>
    </ul>
   <li>
    <a data-link-type="biblio">[FETCH]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-body-with-type">body with type</span>
     <li><span class="dfn-paneled" id="term-for-concept-bodyinit-extract">extract</span>
     <li><span class="dfn-paneled" id="term-for-concept-request">request</span>
    </ul>
   <li>
    <a data-link-type="biblio">[HTML]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-api-base-url">api base url</span>
     <li><span class="dfn-paneled" id="term-for-entry-settings-object">entry settings object</span>
     <li><span class="dfn-paneled" id="term-for-concept-origin">origin</span>
    </ul>
   <li>
    <a data-link-type="biblio">[INFRA]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-boolean">boolean</span>
     <li><span class="dfn-paneled" id="term-for-byte-sequence">byte sequence</span>
     <li><span class="dfn-paneled" id="term-for-list">list</span>
     <li><span class="dfn-paneled" id="term-for-ordered-set">ordered set</span>
    </ul>
   <li>
    <a data-link-type="biblio">[secure-contexts]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-potentially-trustworthy-url">potentially trustworthy url</span>
    </ul>
   <li>
    <a data-link-type="biblio">[URL]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-concept-url">url</span>
     <li><span class="dfn-paneled" id="term-for-concept-url-parser">url parser</span>
     <li><span class="dfn-paneled" id="term-for-concept-urlencoded-serializer">urlencoded serializer</span>
     <li><span class="dfn-paneled" id="term-for-valid-url-string">valid url string</span>
    </ul>
   <li>
    <a data-link-type="biblio">[WEBIDL]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-idl-DOMException">DOMException</span>
     <li><span class="dfn-paneled" id="term-for-Exposed">Exposed</span>
     <li><span class="dfn-paneled" id="term-for-invalidstateerror">InvalidStateError</span>
     <li><span class="dfn-paneled" id="term-for-nomodificationallowederror">NoModificationAllowedError</span>
     <li><span class="dfn-paneled" id="term-for-exceptiondef-typeerror">TypeError</span>
     <li><span class="dfn-paneled" id="term-for-idl-USVString">USVString</span>
     <li><span class="dfn-paneled" id="term-for-idl-boolean">boolean</span>
     <li><span class="dfn-paneled" id="term-for-idl-object">object</span>
     <li><span class="dfn-paneled" id="term-for-this">this</span>
     <li><span class="dfn-paneled" id="term-for-idl-undefined">undefined</span>
     <li><span class="dfn-paneled" id="term-for-idl-unsigned-long">unsigned long</span>
    </ul>
  </ul>
  <h2 class="no-num no-ref heading settled" id="references"><span class="content">References</span><a class="self-link" href="#references"></a></h2>
  <h3 class="no-num no-ref heading settled" id="normative"><span class="content">Normative References</span><a class="self-link" href="#normative"></a></h3>
  <dl>
   <dt id="biblio-dom">[DOM]
   <dd>Anne van Kesteren. <a href="https://dom.spec.whatwg.org/"><cite>DOM Standard</cite></a>. Living Standard. URL: <a href="https://dom.spec.whatwg.org/">https://dom.spec.whatwg.org/</a>
   <dt id="biblio-fetch">[FETCH]
   <dd>Anne van Kesteren. <a href="https://fetch.spec.whatwg.org/"><cite>Fetch Standard</cite></a>. Living Standard. URL: <a href="https://fetch.spec.whatwg.org/">https://fetch.spec.whatwg.org/</a>
   <dt id="biblio-html">[HTML]
   <dd>Anne van Kesteren; et al. <a href="https://html.spec.whatwg.org/multipage/"><cite>HTML Standard</cite></a>. Living Standard. URL: <a href="https://html.spec.whatwg.org/multipage/">https://html.spec.whatwg.org/multipage/</a>
   <dt id="biblio-infra">[INFRA]
   <dd>Anne van Kesteren; Domenic Denicola. <a href="https://infra.spec.whatwg.org/"><cite>Infra Standard</cite></a>. Living Standard. URL: <a href="https://infra.spec.whatwg.org/">https://infra.spec.whatwg.org/</a>
   <dt id="biblio-rfc2119">[RFC2119]
   <dd>S. Bradner. <a href="https://datatracker.ietf.org/doc/html/rfc2119"><cite>Key words for use in RFCs to Indicate Requirement Levels</cite></a>. March 1997. Best Current Practice. URL: <a href="https://datatracker.ietf.org/doc/html/rfc2119">https://datatracker.ietf.org/doc/html/rfc2119</a>
   <dt id="biblio-secure-contexts">[SECURE-CONTEXTS]
   <dd>Mike West. <a href="https://www.w3.org/TR/secure-contexts/"><cite>Secure Contexts</cite></a>. 18 September 2021. CR. URL: <a href="https://www.w3.org/TR/secure-contexts/">https://www.w3.org/TR/secure-contexts/</a>
   <dt id="biblio-url">[URL]
   <dd>Anne van Kesteren. <a href="https://url.spec.whatwg.org/"><cite>URL Standard</cite></a>. Living Standard. URL: <a href="https://url.spec.whatwg.org/">https://url.spec.whatwg.org/</a>
   <dt id="biblio-webidl">[WEBIDL]
   <dd>Edgar Chen; Timothy Gu. <a href="https://webidl.spec.whatwg.org/"><cite>Web IDL Standard</cite></a>. Living Standard. URL: <a href="https://webidl.spec.whatwg.org/">https://webidl.spec.whatwg.org/</a>
  </dl>
  <h3 class="no-num no-ref heading settled" id="informative"><span class="content">Informative References</span><a class="self-link" href="#informative"></a></h3>
  <dl>
   <dt id="biblio-page-visibility">[PAGE-VISIBILITY]
   <dd>Jatinder Mann; Arvind Jain. <a href="https://www.w3.org/TR/page-visibility/"><cite>Page Visibility (Second Edition)</cite></a>. 29 October 2013. REC. URL: <a href="https://www.w3.org/TR/page-visibility/">https://www.w3.org/TR/page-visibility/</a>
  </dl>
  <h2 class="no-num no-ref heading settled" id="idl-index"><span class="content">IDL Index</span><a class="self-link" href="#idl-index"></a></h2>
<pre class="idl highlight def"><c- b>enum</c-> <a href="#enumdef-beaconmethod"><code><c- g>BeaconMethod</c-></code></a> {
    <a href="#dom-beaconmethod-post"><code><c- s>"POST"</c-></code></a>,
    <a href="#dom-beaconmethod-get"><code><c- s>"GET"</c-></code></a>
};

<c- b>dictionary</c-> <a href="#dictdef-pendingbeaconoptions"><code><c- g>PendingBeaconOptions</c-></code></a> {
    <a data-link-type="idl-name" href="#enumdef-beaconmethod"><c- n>BeaconMethod</c-></a> <a data-default="&quot;POST&quot;" data-type="BeaconMethod " href="#dom-pendingbeaconoptions-method"><code><c- g>method</c-></code></a> = "POST";
    <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-unsigned-long"><c- b>unsigned</c-> <c- b>long</c-></a> <a data-type="unsigned long " href="#dom-pendingbeaconoptions-pagehidetimeout"><code><c- g>pageHideTimeout</c-></code></a>;
};

[<a class="idl-code" data-link-type="extended-attribute" href="https://webidl.spec.whatwg.org/#Exposed"><c- g>Exposed</c-></a>=(<c- n>Window</c->, <c- n>Worker</c->)]
<c- b>interface</c-> <a href="#pendingbeacon"><code><c- g>PendingBeacon</c-></code></a> {
    <a class="idl-code" data-link-type="constructor" href="#dom-pendingbeacon-pendingbeacon"><c- g>constructor</c-></a>(<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-USVString"><c- b>USVString</c-></a> <a href="#dom-pendingbeacon-pendingbeacon-url-options-url"><code><c- g>url</c-></code></a>, <c- b>optional</c-> <a data-link-type="idl-name" href="#dictdef-pendingbeaconoptions"><c- n>PendingBeaconOptions</c-></a> <a href="#dom-pendingbeacon-pendingbeacon-url-options-options"><code><c- g>options</c-></code></a> = {});

    <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-USVString"><c- b>USVString</c-></a> <a class="idl-code" data-link-type="attribute" data-type="USVString" href="#dom-pendingbeacon-url"><c- g>url</c-></a>;
    <c- b>attribute</c-> <a data-link-type="idl-name" href="#enumdef-beaconmethod"><c- n>BeaconMethod</c-></a> <a class="idl-code" data-link-type="attribute" data-type="BeaconMethod" href="#dom-pendingbeacon-method"><c- g>method</c-></a>;
    <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-unsigned-long"><c- b>unsigned</c-> <c- b>long</c-></a> <a class="idl-code" data-link-type="attribute" data-type="unsigned long" href="#dom-pendingbeacon-pagehidetimeout"><c- g>pageHideTimeout</c-></a>;
    <c- b>readonly</c-> <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-boolean"><c- b>boolean</c-></a> <a class="idl-code" data-link-type="attribute" data-readonly data-type="boolean" href="#dom-pendingbeacon-ispending"><c- g>isPending</c-></a>;

    <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-undefined"><c- b>undefined</c-></a> <a class="idl-code" data-link-type="method" href="#dom-pendingbeacon-deactivate"><c- g>deactivate</c-></a>();
    <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-undefined"><c- b>undefined</c-></a> <a class="idl-code" data-link-type="method" href="#dom-pendingbeacon-setdata"><c- g>setData</c-></a>(<a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-object"><c- b>object</c-></a> <a href="#dom-pendingbeacon-setdata-data-data"><code><c- g>data</c-></code></a>);
    <a class="idl-code" data-link-type="interface" href="https://webidl.spec.whatwg.org/#idl-undefined"><c- b>undefined</c-></a> <a class="idl-code" data-link-type="method" href="#dom-pendingbeacon-sendnow"><c- g>sendNow</c-></a>();
};

</pre>
  <h2 class="no-num no-ref heading settled" id="issues-index"><span class="content">Issues Index</span><a class="self-link" href="#issues-index"></a></h2>
  <div style="counter-reset:issue">
   <div class="issue"> This introduction needs to be more of an introduction. <a class="issue-return" href="#issue-bee02d4c" title="Jump to section">↵</a></div>
   <div class="issue"> Add worker beacons as well? <a class="issue-return" href="#issue-fdb03e89" title="Jump to section">↵</a></div>
   <div class="issue"> Define these to be part of the user agent formally. <a class="issue-return" href="#issue-a08041ae" title="Jump to section">↵</a></div>
   <div class="issue"> "Check permission" is not defined. A specific permission should be used
here, and this should integrate with the permissions API. <a class="issue-return" href="#issue-5f980fb4" title="Jump to section">↵</a></div>
   <div class="issue"> headerList is not defined. <a class="issue-return" href="#issue-df3133ed" title="Jump to section">↵</a></div>
   <div class="issue"> "discarded" is not well defined. <a class="issue-return" href="#issue-b8b038f0" title="Jump to section">↵</a></div>
   <div class="issue"> The concepts of "process" and "crashes" are not well defined. <a class="issue-return" href="#issue-b08b9417" title="Jump to section">↵</a></div>
   <div class="issue"> "visibility state change" should be more specific here, and should refer
to specific steps in either <a data-link-type="biblio" href="#biblio-page-visibility">[PAGE-VISIBILITY]</a> or <a data-link-type="biblio" href="#biblio-html">[HTML]</a> <a class="issue-return" href="#issue-fa8ec208" title="Jump to section">↵</a></div>
   <div class="issue"> This section is woefully incomplete. These all need to be fleshed out in
enough detail to accurately describe the privacy issues and suggested or
prescribed mitigations. <a class="issue-return" href="#issue-f9fb6d4e" title="Jump to section">↵</a></div>
  </div>
  <aside class="dfn-panel" data-for="pending-beacon">
   <b><a href="#pending-beacon">#pending-beacon</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-pending-beacon">2.1. Concepts</a> <a href="#ref-for-pending-beacon①">(2)</a> <a href="#ref-for-pending-beacon②">(3)</a> <a href="#ref-for-pending-beacon③">(4)</a> <a href="#ref-for-pending-beacon④">(5)</a> <a href="#ref-for-pending-beacon⑤">(6)</a>
    <li><a href="#ref-for-pending-beacon⑥">2.2. Updating beacons</a> <a href="#ref-for-pending-beacon⑦">(2)</a>
    <li><a href="#ref-for-pending-beacon⑧">2.3. Sending beacons</a>
    <li><a href="#ref-for-pending-beacon⑨">3. Integration with HTML</a>
    <li><a href="#ref-for-pending-beacon①⓪">4. The PendingBeacon interface</a> <a href="#ref-for-pending-beacon①①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="pending-beacon-url">
   <b><a href="#pending-beacon-url">#pending-beacon-url</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-pending-beacon-url">2.2. Updating beacons</a>
    <li><a href="#ref-for-pending-beacon-url①">2.3. Sending beacons</a> <a href="#ref-for-pending-beacon-url②">(2)</a>
    <li><a href="#ref-for-pending-beacon-url③">4. The PendingBeacon interface</a> <a href="#ref-for-pending-beacon-url④">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="pending-beacon-method">
   <b><a href="#pending-beacon-method">#pending-beacon-method</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-pending-beacon-method">2.2. Updating beacons</a>
    <li><a href="#ref-for-pending-beacon-method①">2.3. Sending beacons</a>
    <li><a href="#ref-for-pending-beacon-method②">4. The PendingBeacon interface</a> <a href="#ref-for-pending-beacon-method③">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="pending-beacon-timeout">
   <b><a href="#pending-beacon-timeout">#pending-beacon-timeout</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-pending-beacon-timeout">2.2. Updating beacons</a>
    <li><a href="#ref-for-pending-beacon-timeout①">3. Integration with HTML</a>
    <li><a href="#ref-for-pending-beacon-timeout②">4. The PendingBeacon interface</a> <a href="#ref-for-pending-beacon-timeout③">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="pending-beacon-is_pending">
   <b><a href="#pending-beacon-is_pending">#pending-beacon-is_pending</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-pending-beacon-is_pending">2.2. Updating beacons</a> <a href="#ref-for-pending-beacon-is_pending①">(2)</a> <a href="#ref-for-pending-beacon-is_pending②">(3)</a> <a href="#ref-for-pending-beacon-is_pending③">(4)</a> <a href="#ref-for-pending-beacon-is_pending④">(5)</a>
    <li><a href="#ref-for-pending-beacon-is_pending⑤">2.3. Sending beacons</a> <a href="#ref-for-pending-beacon-is_pending⑥">(2)</a>
    <li><a href="#ref-for-pending-beacon-is_pending⑦">3. Integration with HTML</a>
    <li><a href="#ref-for-pending-beacon-is_pending⑧">4. The PendingBeacon interface</a> <a href="#ref-for-pending-beacon-is_pending⑨">(2)</a> <a href="#ref-for-pending-beacon-is_pending①⓪">(3)</a> <a href="#ref-for-pending-beacon-is_pending①①">(4)</a> <a href="#ref-for-pending-beacon-is_pending①②">(5)</a> <a href="#ref-for-pending-beacon-is_pending①③">(6)</a> <a href="#ref-for-pending-beacon-is_pending①④">(7)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="pending-beacon-payload">
   <b><a href="#pending-beacon-payload">#pending-beacon-payload</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-pending-beacon-payload">2.2. Updating beacons</a>
    <li><a href="#ref-for-pending-beacon-payload①">2.3. Sending beacons</a> <a href="#ref-for-pending-beacon-payload②">(2)</a>
    <li><a href="#ref-for-pending-beacon-payload③">4. The PendingBeacon interface</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="document-pending-beacon-set">
   <b><a href="#document-pending-beacon-set">#document-pending-beacon-set</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-document-pending-beacon-set">2.1. Concepts</a>
    <li><a href="#ref-for-document-pending-beacon-set①">2.3. Sending beacons</a>
    <li><a href="#ref-for-document-pending-beacon-set②">3. Integration with HTML</a> <a href="#ref-for-document-pending-beacon-set③">(2)</a> <a href="#ref-for-document-pending-beacon-set④">(3)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="pending-beacon-set-the-url">
   <b><a href="#pending-beacon-set-the-url">#pending-beacon-set-the-url</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-pending-beacon-set-the-url">4. The PendingBeacon interface</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="pending-beacon-set-the-method">
   <b><a href="#pending-beacon-set-the-method">#pending-beacon-set-the-method</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-pending-beacon-set-the-method">4. The PendingBeacon interface</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="pending-beacon-set-the-timeout">
   <b><a href="#pending-beacon-set-the-timeout">#pending-beacon-set-the-timeout</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-pending-beacon-set-the-timeout">4. The PendingBeacon interface</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="pending-beacon-set-the-payload">
   <b><a href="#pending-beacon-set-the-payload">#pending-beacon-set-the-payload</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-pending-beacon-set-the-payload">4. The PendingBeacon interface</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="pending-beacon-cancel">
   <b><a href="#pending-beacon-cancel">#pending-beacon-cancel</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-pending-beacon-cancel">4. The PendingBeacon interface</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="send-a-documents-beacons">
   <b><a href="#send-a-documents-beacons">#send-a-documents-beacons</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-send-a-documents-beacons">3. Integration with HTML</a> <a href="#ref-for-send-a-documents-beacons①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="send-a-queued-pending-beacon">
   <b><a href="#send-a-queued-pending-beacon">#send-a-queued-pending-beacon</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-send-a-queued-pending-beacon">2.3. Sending beacons</a>
    <li><a href="#ref-for-send-a-queued-pending-beacon①">3. Integration with HTML</a>
    <li><a href="#ref-for-send-a-queued-pending-beacon②">4. The PendingBeacon interface</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="send-a-pending-beacon-over-get">
   <b><a href="#send-a-pending-beacon-over-get">#send-a-pending-beacon-over-get</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-send-a-pending-beacon-over-get">2.3. Sending beacons</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="send-a-pending-beacon-over-post">
   <b><a href="#send-a-pending-beacon-over-post">#send-a-pending-beacon-over-post</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-send-a-pending-beacon-over-post">2.3. Sending beacons</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="enumdef-beaconmethod">
   <b><a href="#enumdef-beaconmethod">#enumdef-beaconmethod</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-enumdef-beaconmethod">4. The PendingBeacon interface</a> <a href="#ref-for-enumdef-beaconmethod①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dictdef-pendingbeaconoptions">
   <b><a href="#dictdef-pendingbeaconoptions">#dictdef-pendingbeaconoptions</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dictdef-pendingbeaconoptions">4. The PendingBeacon interface</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-pendingbeaconoptions-method">
   <b><a href="#dom-pendingbeaconoptions-method">#dom-pendingbeaconoptions-method</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-pendingbeaconoptions-method">4. The PendingBeacon interface</a> <a href="#ref-for-dom-pendingbeaconoptions-method①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-pendingbeaconoptions-pagehidetimeout">
   <b><a href="#dom-pendingbeaconoptions-pagehidetimeout">#dom-pendingbeaconoptions-pagehidetimeout</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-pendingbeaconoptions-pagehidetimeout">4. The PendingBeacon interface</a> <a href="#ref-for-dom-pendingbeaconoptions-pagehidetimeout①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="pendingbeacon">
   <b><a href="#pendingbeacon">#pendingbeacon</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-pendingbeacon">4. The PendingBeacon interface</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="pendingbeacon-beacon">
   <b><a href="#pendingbeacon-beacon">#pendingbeacon-beacon</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-pendingbeacon-beacon">4. The PendingBeacon interface</a> <a href="#ref-for-pendingbeacon-beacon①">(2)</a> <a href="#ref-for-pendingbeacon-beacon②">(3)</a> <a href="#ref-for-pendingbeacon-beacon③">(4)</a> <a href="#ref-for-pendingbeacon-beacon④">(5)</a> <a href="#ref-for-pendingbeacon-beacon⑤">(6)</a> <a href="#ref-for-pendingbeacon-beacon⑥">(7)</a> <a href="#ref-for-pendingbeacon-beacon⑦">(8)</a> <a href="#ref-for-pendingbeacon-beacon⑧">(9)</a> <a href="#ref-for-pendingbeacon-beacon⑨">(10)</a> <a href="#ref-for-pendingbeacon-beacon①⓪">(11)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-pendingbeacon-pendingbeacon">
   <b><a href="#dom-pendingbeacon-pendingbeacon">#dom-pendingbeacon-pendingbeacon</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-pendingbeacon-pendingbeacon">4. The PendingBeacon interface</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-pendingbeacon-url">
   <b><a href="#dom-pendingbeacon-url">#dom-pendingbeacon-url</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-pendingbeacon-url">4. The PendingBeacon interface</a> <a href="#ref-for-dom-pendingbeacon-url①">(2)</a> <a href="#ref-for-dom-pendingbeacon-url②">(3)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-pendingbeacon-method">
   <b><a href="#dom-pendingbeacon-method">#dom-pendingbeacon-method</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-pendingbeacon-method">4. The PendingBeacon interface</a> <a href="#ref-for-dom-pendingbeacon-method①">(2)</a> <a href="#ref-for-dom-pendingbeacon-method②">(3)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-pendingbeacon-pagehidetimeout">
   <b><a href="#dom-pendingbeacon-pagehidetimeout">#dom-pendingbeacon-pagehidetimeout</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-pendingbeacon-pagehidetimeout">4. The PendingBeacon interface</a> <a href="#ref-for-dom-pendingbeacon-pagehidetimeout①">(2)</a> <a href="#ref-for-dom-pendingbeacon-pagehidetimeout②">(3)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-pendingbeacon-ispending">
   <b><a href="#dom-pendingbeacon-ispending">#dom-pendingbeacon-ispending</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-pendingbeacon-ispending">4. The PendingBeacon interface</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-pendingbeacon-deactivate">
   <b><a href="#dom-pendingbeacon-deactivate">#dom-pendingbeacon-deactivate</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-pendingbeacon-deactivate">4. The PendingBeacon interface</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-pendingbeacon-setdata">
   <b><a href="#dom-pendingbeacon-setdata">#dom-pendingbeacon-setdata</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-pendingbeacon-setdata">4. The PendingBeacon interface</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-pendingbeacon-sendnow">
   <b><a href="#dom-pendingbeacon-sendnow">#dom-pendingbeacon-sendnow</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-pendingbeacon-sendnow">4. The PendingBeacon interface</a>
   </ul>
  </aside>
<script>/* script-dfn-panel */

document.body.addEventListener("click", function(e) {
    var queryAll = function(sel) { return [].slice.call(document.querySelectorAll(sel)); }
    // Find the dfn element or panel, if any, that was clicked on.
    var el = e.target;
    var target;
    var hitALink = false;
    while(el.parentElement) {
        if(el.tagName == "A") {
            // Clicking on a link in a <dfn> shouldn't summon the panel
            hitALink = true;
        }
        if(el.classList.contains("dfn-paneled")) {
            target = "dfn";
            break;
        }
        if(el.classList.contains("dfn-panel")) {
            target = "dfn-panel";
            break;
        }
        el = el.parentElement;
    }
    if(target != "dfn-panel") {
        // Turn off any currently "on" or "activated" panels.
        queryAll(".dfn-panel.on, .dfn-panel.activated").forEach(function(el){
            el.classList.remove("on");
            el.classList.remove("activated");
        });
    }
    if(target == "dfn" && !hitALink) {
        // open the panel
        var dfnPanel = document.querySelector(".dfn-panel[data-for='" + el.id + "']");
        if(dfnPanel) {
            dfnPanel.classList.add("on");
            var rect = el.getBoundingClientRect();
            dfnPanel.style.left = window.scrollX + rect.right + 5 + "px";
            dfnPanel.style.top = window.scrollY + rect.top + "px";
            var panelRect = dfnPanel.getBoundingClientRect();
            var panelWidth = panelRect.right - panelRect.left;
            if(panelRect.right > document.body.scrollWidth && (rect.left - (panelWidth + 5)) > 0) {
                // Reposition, because the panel is overflowing
                dfnPanel.style.left = window.scrollX + rect.left - (panelWidth + 5) + "px";
            }
        } else {
            console.log("Couldn't find .dfn-panel[data-for='" + el.id + "']");
        }
    } else if(target == "dfn-panel") {
        // Switch it to "activated" state, which pins it.
        el.classList.add("activated");
        el.style.left = null;
        el.style.top = null;
    }

});
</script>
<script>/* script-var-click-highlighting */

    document.addEventListener("click", e=>{
        if(e.target.nodeName == "VAR") {
            highlightSameAlgoVars(e.target);
        }
    });
    {
        const indexCounts = new Map();
        const indexNames = new Map();
        function highlightSameAlgoVars(v) {
            // Find the algorithm container.
            let algoContainer = null;
            let searchEl = v;
            while(algoContainer == null && searchEl != document.body) {
                searchEl = searchEl.parentNode;
                if(searchEl.hasAttribute("data-algorithm")) {
                    algoContainer = searchEl;
                }
            }

            // Not highlighting document-global vars,
            // too likely to be unrelated.
            if(algoContainer == null) return;

            const algoName = algoContainer.getAttribute("data-algorithm");
            const varName = getVarName(v);
            const addClass = !v.classList.contains("selected");
            let highlightClass = null;
            if(addClass) {
                const index = chooseHighlightIndex(algoName, varName);
                indexCounts.get(algoName)[index] += 1;
                indexNames.set(algoName+"///"+varName, index);
                highlightClass = nameFromIndex(index);
            } else {
                const index = previousHighlightIndex(algoName, varName);
                indexCounts.get(algoName)[index] -= 1;
                highlightClass = nameFromIndex(index);
            }

            // Find all same-name vars, and toggle their class appropriately.
            for(const el of algoContainer.querySelectorAll("var")) {
                if(getVarName(el) == varName) {
                    el.classList.toggle("selected", addClass);
                    el.classList.toggle(highlightClass, addClass);
                }
            }
        }
        function getVarName(el) {
            return el.textContent.replace(/(\s|\xa0)+/, " ").trim();
        }
        function chooseHighlightIndex(algoName, varName) {
            let indexes = null;
            if(indexCounts.has(algoName)) {
                indexes = indexCounts.get(algoName);
            } else {
                // 7 classes right now
                indexes = [0,0,0,0,0,0,0];
                indexCounts.set(algoName, indexes);
            }

            // If the element was recently unclicked,
            // *and* that color is still unclaimed,
            // give it back the same color.
            const lastIndex = previousHighlightIndex(algoName, varName);
            if(indexes[lastIndex] === 0) return lastIndex;

            // Find the earliest index with the lowest count.
            const minCount = Math.min.apply(null, indexes);
            let index = null;
            for(var i = 0; i < indexes.length; i++) {
                if(indexes[i] == minCount) {
                    return i;
                }
            }
        }
        function previousHighlightIndex(algoName, varName) {
            return indexNames.get(algoName+"///"+varName);
        }
        function nameFromIndex(index) {
            return "selected" + index;
        }
    }
    </script>